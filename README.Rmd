---
title:  "Datapaper Draft: Standardized datasets of Brazilian reef biodiversity in space and time"
author: "Reef Synthesis Working Group; Luza, AL, Cordeiro, CAMM, ..., Aued, AW, Ferreira, CEL, Mendes, T., Roos, N, Longo, GO, Francini-Filho, RB, Floeter, SR, Bender, MG"
date: "2022/08/16"
output: github_document # word_document
---


<!-- README.md is generated from README.Rmd. Please edit that file -->

<!-- badges: start -->
<!-- badges: end -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Introduction (topic: Ecological Synthesis, and who are we?)

The recent rise of ecological synthesis has two main reasons: ecology is both entering in the age of big data (Michener & Jones 2012), and is increasingly applying the principles of open science (UNESCO 2021, Reichman et al. 2011). We are now experiencing a transition from isolated research, with data stored in the drawer, to a global research network with data stored in public repositories available to be used for leveraging further research (Reichman et al. 2011). Brazil have just started to track this trend. The 'Sinbiose', the Center for Synthesis in Biodiversity and Ecosystem Services (see <http://www.sinbiose.cnpq.br/web/sinbiose/home>), comprises a pioneer initiative within Latin America in terms of ecological synthesis and application of open-science principles (Luza et al., in prep.). There are seven working groups funded by the SinBiose, from which the ReefSYN--**ReefSYN Working Group**
-- is the unique group working with marine ecosystems, particularly those biogenic and rocky reefs of the Brazilian marine biogeographical province (Briggs 1974)).

The ReefSYN is composed of a team with 22 researchers (20 early-career and senior researchers, assisted by two post-doctoral researchers) from several countries and institutions  (Fig. 1). Up to this date, most team members performed research in isolation, each one covering a specific dimension of reef biodiversity (Fig. 1). By getting funding and support from the Sinbiose we have now the chance to gather existing data, make data synthesis, and bring together different research expertise/fields/perspectives to engage into a common objective with large societal implications: *Provide a synthesis about patterns and drivers of reef diversity and ecological services provision  in Brazil*. More information about our group can be found at <https://reefsyn.weebly.com/home-us.html>.

By standardizing these data to a common, globally accepted standard --the Darwin Core Standard-- it would be possible to integrate data and make data synthesis to answer ambitious questions about the functioning of Brazilian reef ecosystems, as well quantify, given the distribution of data in space and time, the influence of humans on reef biodiversity and ecosystem services. To this end, we bring this datapaper showing how the data gathered by ReefSYN is organized, and leave it available to other users.

```{r, echo = F, fig.height=6.5,fig.width=6.5,fig.margin=F,fig.align="center", message=F,warning=F,out.width="100%",out.height="100%"}


## R code to load data sets and plot points
## call packages

source("R/packages.R")
source("R/functions.R")



# open researcher data
researcher_data <- read.xlsx(here::here("Data","researcher_data","PLANILHA_CONSOLIDADA.xlsx"), sheet = 1, colNames = TRUE, detectDates=F)
# formatting data
researcher_data$objetivos <- as.character (researcher_data$objetivos)
researcher_data$titulo_portugues <- as.character (researcher_data$titulo_portugues)
researcher_data$titulo_ingles <- as.character (researcher_data$titulo_ingles)

## extrair as colunas que desejo analaisar
institution <- strsplit(researcher_data$instituicao,",")
institution <- unlist(strsplit(unlist(institution), "/"))
institution <- gsub (" ","",institution)
# df for word-cloud
institution <- data.frame (inst=unique(institution) [order (unique(institution))],
                           freq=table(institution) [order (names(table(institution)))])

### titulo em ingles
titulo_ingles <- as.character (researcher_data$titulo_ingles [which(researcher_data$titulo_ingles != "Indefinido")])
## gerar df para o wcloud
freq_texto_wc <-  function_freq_texto_wc (titulo_ingles)

par(mfrow=c(1,2),mar=rep(0, 4))

## inst
wordcloud::wordcloud(words = institution$inst, freq = institution$freq.Freq,
          min.freq = 1,scale=c(4, .2),
          max.words=50, 
          random.order=FALSE, rot.per=0.15, 
          colors=brewer.pal(8, "Dark2"))


# tit english
wordcloud::wordcloud(words = freq_texto_wc$word, 
          freq = freq_texto_wc$freq.Freq,
          min.freq = 2,scale=c(4, .2),
          max.words=max(freq_texto_wc$freq.Freq)+3, 
          random.order=FALSE, rot.per=0.15, 
          colors=brewer.pal(8, "Dark2"))



```
Fig. 1: Institutions and research topics explored by the ReefSYN team members.


## 2. Methodology

# 2.1 Geographic and temporal coverage (Topic: Spatial and temporal distribution of data)

From 2001 up to 2020, several of the components of ReefSYN gathered data of fish and benthic organisms (e.g., algae, corals) in more than 400 sites distributed throughout the Brazilian coast and oceanic islands (Fig. 2, Tables 1 and 2). All these data came from geographically replicated, large-scale research programs conducted over the last decades in Brazil (SISBOTA-MAR, PELD-ILOC, Abrolhos Bank monitoring) and from novel initiatives such as the monitoring of reef fish and benthos of Rio Grande do Norte (e.g., Ross et al. 2019).

The Brazilian marine biogeographical province (Briggs, 1974; Floeter et al., 2008; Pinheiro et al., 2018), located in Southwestern Atlantic, host reefs with mostly turbid and nutrient-rich waters due to the sediment discharge from several rivers that flow into the coast  (Aued et al., 2018; Loiola et al., 2019; Mies et al., 2020). The narrow continental shelf hosts coral and rocky reefs reefs disposed along more than 27 degrees of latitude (0.91N to 27.6S latitude degrees; Fig. 3). The reefs are exposed to varied temperature, productivity and salinity settings, producing a north/northeast and south/southeast regionalization of the coast (Cord et al., 2022; Pinheiro et al., 2018). Far from the coast there are four oceanic islands, which host coralligenous and rocky reefs, with high endemism levels, and a varied similarity in species composition to that of coastal reefs (Cord et al., 2022; Pinheiro et al., 2018). Recent analysis of spatially extensive benthic datasets revealed clear-water reef communities occurring in the oceanic islands and in oligotrophic waters from the Northeast region, whereas turbid-water reef communities occur throughout the coast (Santana et al. 2023).

The sampling effort was not evenly distributed in time. Indeed, since 2001, the number of samples increased considerably over time, as well the number of sampled taxa (Fig. 2). Notably, the cumulative number of eventIDs (i.e. information associated with an event of sampling (something that occurs at a place and time), Darwin Core Task Group (2009)) across the datasets over time show that i) there was an abrupt increase in the number of eventIDs after 2013, mainly for benthos (probably leveraged by the Sisbiota-Mar project (CNPq)), ii) large projects such as Sisbiota-Mar and PELD ILOC have already made an effort to gather data from previous initiatives (Krajewksi & Floeter 2011), iii) there was a nearly constant increase in the number of fish scientific names over time. For benthos, in contrast, there were years of constancy amid years of abrupt increase in the number of identified taxa (Figs. 3 and 4).




```{r, echo = F, fig.height=5, fig.width=8, message=F, warning=F, fig.align= "center", out.width="100%", out.height="100%"}

# load Datasets
# benthos
ds1<- read.csv (here::here("DwC_output", "AAued_spatialData", "event_core.csv"))
ds2<- read.csv (here::here("DwC_output", "GLongo_NRoss_spatialData", "event_core_benthos.csv"))
ds3<- read.table (here::here("DwC_output","PELD_iloc_benthos", "event_core.txt"),h=T,sep=",")
colnames(ds3)[which(colnames(ds3) == "island")] <- "site"
colnames(ds3)[which(colnames(ds3) == "eventYear")] <- "year"
ds3$higherGeography <- "BrazilianOceanicIslands"
ds4<- read.csv (here::here("DwC_output","RFrancini_spatialData", "event_core.csv"))
ds5<- read.csv (here::here("DwC_output","RFrancini_timeSeries_abrolhos","event_core_benthos.csv"))

# fish
ds6<- read.csv (here::here("DwC_output","GLongo_NRoss_spatialData", "event_core_fish.csv"))
ds7<- read.csv (here::here("DwC_output","GLongo_spatialData", "event_core.csv"))
ds8<- read.table (here::here("DwC_output","PELD_iloc_fish", "event_core.txt"),h=T, sep= ";")
colnames(ds8)[which(colnames(ds8) == "island")] <- "site"
colnames(ds8)[which(colnames(ds8) == "eventYear")] <- "year" # 
ds8 <- ds8 [which(ds8$site != "Ascension"),] # removing Ascension
ds8$higherGeography <- "BrazilianOceanicIslands"
ds9<- read.csv (here::here("DwC_output","RFrancini_timeSeries_abrolhos","event_core_fish.csv"))
ds10<- read.csv (here::here("DwC_output","RJ_time_series", "event_core.csv"))
ds11<- read.csv (here::here("DwC_output","RMorais_spatialData", "event_core.csv"))
ds12<- read.csv (here::here("DwC_output","SC_time_series", "event_core.csv"))


# list of sites with sampling of benthic communities
list_benthos <- list(data.frame (ds1, Dataset= "I"),
                     data.frame (ds4, Dataset = "II"),
                     data.frame (ds3, Dataset ="III"),
                     data.frame (ds2, Dataset="IV"),
                     data.frame (ds5, Dataset = "V"))



# agggregate and get coordinates for each site
coords <- lapply (list_benthos, function (i) 
  
  
  dplyr::group_by(i, Dataset, higherGeography, site, locality) %>% 
  
                    summarise(decimalLatitude = mean(decimalLatitude),
                            decimalLongitude = mean(decimalLongitude)) %>% 
    
                  select (higherGeography, site, locality,
                          decimalLatitude, decimalLongitude)
)

# melt
coords <- do.call(rbind, coords)


# map
# mapa mundi
world <- ne_countries(scale = "medium", returnclass = "sf")

# cortar o mapa para ver a america do Sul e parte da central
wm <- ggplot() + 
  geom_sf (data=world, size = 0.1, 
           fill= "gray90",colour="gray90") +
  coord_sf (xlim = c(-50, -25),  ylim = c(-30, 4), expand = FALSE) +
  theme_bw() + xlab ("Longitude")  + ylab ("Latitude") +
  theme(panel.border = element_blank(), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "lightcyan",#darkslategray1
                                        colour = "lightcyan"),
        
        axis.text.x = element_text(size=6),
        axis.ticks.x=element_line(size=1),
        axis.text.y = element_text(size=6),
        axis.ticks.y=element_line(size=1),
        axis.title.x = element_text(size=8),
        axis.title.y = element_text(size=8),
        title = element_text(size=9)) 

# map
wm_data <- wm +  geom_jitter(data = coords, 
                             aes(x = decimalLongitude, 
                                 y = decimalLatitude,
                                 col = Dataset,
                                 fill=Dataset), 
                            size =4, position= "jitter",
                            stat = "identity",
        shape = 19, alpha=0.3) +
  theme (plot.background = element_rect("#EBEBEB"),
        #panel.background = element_blank(),
        axis.title = element_text(color = "#292929", face = "bold"),
        axis.text = element_text(color = "#292929", face = "bold"),
         legend.text = element_text(size =6),
        legend.title = element_text(size =7),
        legend.key.height= unit(0.3, 'cm'),
        legend.key.width= unit(0.1, 'cm'),
        panel.grid = element_blank())+
  scale_colour_viridis_d(option="magma", end=0.8)+
  ggtitle (paste ("Data of benthic communities", "n=", nrow(coords), sep=" "))  +
  guides(colour = guide_legend(override.aes = list(alpha=1)))


# ================
# fish

list_fish <- list(data.frame (ds11, Dataset = "I"),
                  data.frame (ds7, Dataset = "II"),
                  data.frame (ds8, Dataset = "III"),
                  data.frame (ds6, Dataset = "IV"),
                  data.frame (ds12, Dataset = "V"),
                  data.frame (ds10, Dataset = "VI"),
                  data.frame (ds9, Dataset = "VII")
                  
                  )


# agggregate and get coordinates for each site
coords_fish <- lapply (list_fish, function (i) 
  
  
  group_by(i,Dataset, higherGeography, site, locality) %>% 
  
                    summarise(decimalLatitude = mean( decimalLatitude,na.rm=T),
                            decimalLongitude = mean( decimalLongitude,na.rm=T)) %>% 
    
                  select (higherGeography,site, locality,
                          decimalLatitude,decimalLongitude)
)

# melt
coords_fish <- do.call(rbind,coords_fish)


# map
wm_data_fish <- wm +  geom_point(data = coords_fish, aes(x = decimalLongitude, 
                                                         y = decimalLatitude,
                                                         col = Dataset,
                                                         fill=Dataset), 
                            size =4, position= "jitter",
        shape = 19, alpha=0.3) + 
  scale_colour_viridis_d(direction=1)+
  theme (plot.background = element_rect("#EBEBEB"),
        #panel.background = element_blank(),
        axis.title = element_text(color = "#292929", face = "bold"),
        axis.text = element_text(color = "#292929", face = "bold"),
        legend.text = element_text(size =6),
        legend.title = element_text(size =7),
        legend.key.height= unit(0.3, 'cm'),
        legend.key.width= unit(0.1, 'cm'),
        panel.grid = element_blank())+
  ggtitle (paste ("Data of fish commnities", "n=", nrow(coords_fish), sep=" ")) +
  guides(colour = guide_legend(override.aes = list(alpha=1))) 


grid.arrange(wm_data,
             wm_data_fish,ncol=2)



```
Fig. 2: Spatial distribution of sampling sites of fish (left) and benthos (right) per dataset.


Table 1: Description of reef benthic datasets.

```{r, echo = F, results='asis'}

# the number of sampling events per dataset

table_description_data_benthos <- lapply (list_benthos, function (i)
  
    data.frame ("Sampling protocol" = table(i$samplingProtocol),
                "Dataset" = unique(i$Dataset),
                "Scale" = "Plot/point",
                "Sample size (m2)" = mean (i$sampleSizeValue),
                "Nsites" = length(unique(i$site)),
                "Latitude" = paste (round (min (i$decimalLatitude),2),
                                    round (max (i$decimalLatitude),2),
                                    sep=", "),
                "Longitude" = paste (round (min (i$decimalLongitude),2),
                                    round (max (i$decimalLongitude),2),
                                    sep=", "),
                "Years" = paste (round (min (i$year,na.rm=T),2),
                                    round (max (i$year,na.rm=T),2),
                                    sep="-"))
)

# melt
table_description_data_benthos<-do.call(rbind,table_description_data_benthos)
#sum(table_description_data_benthos$eventIDs)
# fish

table_description_data_fish <- lapply (list_fish, function (i)
  
    data.frame ("Sampling protocol" = (table(i$samplingProtocol)),
                "Dataset" = unique(i$Dataset),
                "Scale" = "Transect/plot",
                "Sample size (m2)" = mean (i$sampleSizeValue),
                "Nsites" = length(unique(i$site)),
                "Latitude" = paste (round (min (i$decimalLatitude,na.rm=T),2),
                                    round (max (i$decimalLatitude,na.rm=T),2),
                                    sep=", "),
                "Longitude" = paste (round (min (i$decimalLongitude,na.rm=T),2),
                                    round (max (i$decimalLongitude,na.rm=T),2),
                                    sep=", "),
                "Years" = paste (round (min (i$year,na.rm=T),2),
                                    round (max (i$year,na.rm=T),2),
                                    sep="-"))
)
# melt
table_description_data_fish<-do.call(rbind,table_description_data_fish)
# totals
# sum(table_description_data_fish$eventIDs)

kable (table_description_data_benthos, col.names = c("Sampling Protocol",
                                                     "Number of samples",
                                                     "Dataset Name",
                                                     "Scale",
                                                     "Sample size (m2)",
                                                     "Number of sites",
                                                     "Latitudinal range",
                                                     "Longitudinal range",
                                                     "Years"),
       align="c")


```



Table 2: Description of reef fish datasets.


```{r, echo = F, results='asis'}

kable (table_description_data_fish, col.names = c("Sampling Protocol",
                                                     "Number of samples",
                                                     "Dataset Name",
                                                      "Scale",
                                                     "Sample size (m2)",
                                                   "Number of sites",
                                                     "Latitudinal range",
                                                     "Longitudinal range",
                                                  "Years"),
       align="c")

```



```{r, echo = F, fig.height=5,fig.width=8,message=F, warning=F,fig.align= "center",out.width="100%",out.height="100%"}


# benthos
# number of eventIDs (rows per year)
eventIDs_year <- lapply (list_benthos, function (i) i %>% 
                           group_by (year,Dataset) %>% 
                           tally()  # the number of eventIDs
                         
                         )
# count the ids
eventIDs_year_benthos<-do.call(rbind,eventIDs_year) %>%
                           
                          group_by(year) %>%
                           
                          summarise (sum_cum = sum (n)) %>% # sum the number of ids per year
                          mutate(n_cum = cumsum(sum_cum)) # find the cumulative sum

# the beggining of each Dataset
begin_data <- do.call(rbind,eventIDs_year) %>%
                           
                          group_by(Dataset) %>%
                          
                          summarise (min_year = min (year,na.rm=T)) 


# fish
# number of eventIDs (rows per year)
eventIDs_yearB <- lapply (list_fish, function (i) i %>% 
                           group_by (year,Dataset) %>% 
                           tally()  # the number of eventIDs
                         
                         )
# count the ids
eventIDs_year_fish<-do.call(rbind,eventIDs_yearB) %>%
                           
                          group_by(year) %>%
                           
                          summarise (sum_cum = sum (n)) %>% # sum the number of ids per year
                          mutate(n_cum = cumsum(sum_cum)) # find the cumulative sum

# the beggining of each Dataset
begin_data_fish <- do.call(rbind,eventIDs_yearB) %>%
                           
                          group_by(Dataset) %>%
                          
                          summarise (min_year = min (year,na.rm=T)) 


# bind the years in the fish Dataset missing in the benthic Datasets
to_bind_benthos <- data.frame (year = c(2001, 2002,2020,2021,2022),
                               sum_cum=c(0,0,max(eventIDs_year_benthos$sum_cum),
                                          max(eventIDs_year_benthos$sum_cum),
                                          max(eventIDs_year_benthos$sum_cum)),
                               n_cum=c(0,0,max(eventIDs_year_benthos$n_cum),
                                       max(eventIDs_year_benthos$n_cum),
                                       max(eventIDs_year_benthos$n_cum)))

# bind
eventIDs_year_benthos <- bind_rows (eventIDs_year_benthos,
                                    to_bind_benthos) %>% 
  
              arrange (year)


# plot 
# benthos
trend_benthos <- ggplot (data = eventIDs_year_benthos, aes (x=year,y=n_cum)) + 
  geom_area(alpha=0.5, fill = "#FD8235", col = "gray30",size=2) + 
  theme(plot.background = element_rect("#EBEBEB"),
        panel.background = element_blank(),
        axis.title = element_text(color = "#292929", face = "bold"),
        axis.text = element_text(color = "#292929", face = "bold"),
        panel.grid = element_blank()) + 
  xlab ("") + ylab ("") 

trend_benthos_annotate <- trend_benthos + geom_text(data = begin_data, aes (x= min_year, y = 2500,
                                                  label = Dataset,
                                                  angle = 270),
                                                  size = 3) + 
  geom_segment(data = begin_data, 
               aes(x = min_year, y = 0, xend = min_year, yend = 1500)) + 
  geom_segment(aes(x = 2011, y = -100, xend = 2014, yend = -100),size=3,col="gray30")+
  geom_segment(aes(x = 2013, y = 100, xend = 2022, yend = 100),size=3,col="gray60")+
  geom_segment(aes(x = 2020, y = 300, xend = 2022, yend = 300),size=3,col="#5A8F7B")

# fish
trend_fish <- ggplot (data = eventIDs_year_fish, aes (x=year,y=n_cum)) + 
  geom_area(alpha=0.5, fill = "#6CC4A1", col = "gray30",size=2) + 
  theme(plot.background = element_rect("#EBEBEB"),
        panel.background = element_blank(),
        axis.title.y = element_text(color = "#292929", face = "bold"),
        axis.text.y = element_text(color = "#292929", face = "bold"),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),# element_text(color = "#292929", face = "bold"),
        panel.grid = element_blank()) + 
  xlab ("") + ylab ("") 

trend_fish_annotate <- trend_fish + geom_text_repel(data = begin_data_fish, aes (x= min_year, y = 15000,
                                                  label = Dataset,
                                                  angle = 270),
                                                  size = 3,
                                                  box.padding=0) + 
  geom_segment(data = begin_data_fish, 
               aes(x = min_year, y = 0, xend = min_year, yend = 10000)) +
   geom_segment(aes(x = 2011, y = -400, xend = 2014, yend = -400),size=3,col="gray30")+
  geom_segment(aes(x = 2013, y = 500, xend = 2022, yend = 500),size=3,col="gray60")+
  geom_segment(aes(x = 2020, y = 1300, xend = 2022, yend = 1300),size=3,col="#5A8F7B")+
  
  scale_y_reverse()


grid.arrange (trend_benthos_annotate,
              trend_fish_annotate,
              nrow=2,
              left = "Cumulative number of sampling events (eventIDs)") 



```
Fig. 3: The number of sampling events accumulated over time for benthos (top) and fish (bottom). One sampling event consist, for example, on one transect deployed into a locality. The vertical segments depict the year in which data included in each Dataset started to be collected. The horizontal bars depict the formal funding as follows: dark gray bar: Sisbiota, CNPq; light gray bar: PELD, CNPq; green bar: ReefSYN, Sinbiose CNPq. 




```{r, echo = F, fig.height=5,fig.width=8,message=F, warning=F, fig.align= "center",out.width="100%",out.height="100%"}

# load Datasets
# benthos
ds1_occ<- read.csv (here::here("DwC_output","AAued_spatialData", "DF_occ.csv"))
ds1_occ$year<- ds1 [match (ds1_occ$eventID, ds1$eventID), "year"]
ds2_occ<- read.csv (here::here("DwC_output","GLongo_NRoss_spatialData", "DF_occ_benthos.csv"))
ds2_occ$year<- ds2 [match (ds2_occ$eventID, ds2$eventID), "year"]
ds3_occ<- read.table (here::here("DwC_output","PELD_iloc_benthos", "DF_occ.txt"),sep = ",",h=T)
ds3_occ$year<- ds3 [match (ds3_occ$eventID, ds3$eventID), "year"]
colnames(ds3_occ)[which(colnames(ds3_occ) == "island")] <- "site"
colnames(ds3_occ)[which(colnames(ds3_occ) == "eventYear")] <- "year"
ds3_occ$higherGeography <- "BrazilianOceanicIslands"
ds4_occ<- read.csv (here::here("DwC_output","RFrancini_spatialData", "DF_occ.csv"))
ds4_occ$year<- ds4 [match (ds4_occ$eventID, ds4$eventID), "year"]
ds5_occ<- read.csv (here::here("DwC_output","RFrancini_timeSeries_abrolhos","DF_occ_benthos.csv"))
ds5_occ$year<- ds5 [match (ds5_occ$eventID, ds5$eventID), "year"]

# fish

ds6_occ<- read.csv (here::here("DwC_output","GLongo_NRoss_spatialData", "DF_occ_fish.csv"))
ds6_occ$year<- ds6 [match (ds6_occ$eventID, ds6$eventID), "year"]
ds7_occ<- read.csv (here::here("DwC_output","GLongo_spatialData", "DF_occ.csv"))
ds7_occ$year<- ds7 [match (ds7_occ$eventID, ds7$eventID), "year"]
ds8_occ<- read.table (here::here("DwC_output","PELD_iloc_fish", "DF_occ.txt"),h=T, sep = ";")
ds8_occ$higherGeography <- "BrazilianOceanicIslands"
ds8_occ$year<- ds8 [match (ds8_occ$eventID, ds8$eventID), "year"]
ds9_occ<- read.csv (here::here("DwC_output","RFrancini_timeSeries_abrolhos","DF_occ_fish.csv"))
ds9_occ$year<- ds9 [match (ds9_occ$eventID, ds9$eventID), "year"]
ds10_occ<- read.csv (here::here("DwC_output","RJ_time_series", "DF_occ.csv"))
ds10_occ$year<- ds10 [match (ds10_occ$eventID, ds10$eventID), "year"]
ds11_occ<- read.csv (here::here("DwC_output","RMorais_spatialData", "DF_occ.csv"))
ds11_occ$year<- ds11 [match (ds11_occ$eventID, ds11$eventID), "year"]
ds12_occ<- read.csv (here::here("DwC_output","SC_time_series", "DF_occ.csv"))
ds12_occ$year<- ds12 [match (ds12_occ$eventID, ds12$eventID), "year"]



# list of sites with sampling of benthic communities
list_occ_benthos <- list(data.frame (ds1_occ, Dataset= "I"),
                     data.frame (ds4_occ, Dataset = "II"),
                     data.frame (ds3_occ, Dataset ="III"),
                     data.frame (ds2_occ, Dataset="IV"),
                     data.frame (ds5_occ, Dataset = "V")
                     )



# ================
# fish

list_occ_fish <- list(data.frame (ds11_occ, Dataset = "I"),    
                  data.frame (ds7_occ, Dataset = "II"),
                  data.frame (ds8_occ, Dataset = "III"),
                  data.frame (ds6_occ, Dataset = "IV"),
                  data.frame (ds12_occ, Dataset = "V"),
                  data.frame (ds10_occ, Dataset = "VI"),
                  data.frame (ds9_occ, Dataset = "VII")
                  )





## project richness
# benthos
# number of spp year (rows per year)
library(tidyr)
library(dplyr)
require(reshape2)
require(magrittr)

spp_year <- do.call(rbind ,
                    
                    lapply (list_occ_benthos, function (i)  
                      
                    
                        i %>% select (year,scientificName,Dataset) # interesting columns
  
                              
                       )) %>% 
  
                dcast (formula = year  ~scientificName, # table
                                  drop=T) %>%
                        
                  
                  set_rownames(.$year)   # set rownames

                    
                

# composition matrix
spp_year <-  ifelse (spp_year >=1,1,0)
spp_year <- spp_year [,-which(colnames(spp_year) == "NA")]# rm NA cols

# aggregate
agg_data_year1 <- sum (spp_year[1,-1]>0)
acc_time <- lapply (seq (2,nrow(spp_year)), function (i){
  
        agg_data <- aggregate (
               data.frame (spp_year[1:i,]), 
                   by = list (spp_year[1:i,"year"]),
                   FUN = sum)[,-c(1,2)]
        sum_sp <- sum (agg_data>0)
        sum_sp
})
acc_time<- c(agg_data_year1, unlist(acc_time))
acc_time <- data.frame(SR = acc_time, 
           year = as.numeric(rownames(spp_year)))
acc_time<-rbind (acc_time,
                 data.frame  (SR=max(acc_time$SR), 
                              year=c(2020,2021,2022)))

# fish 

spp_year_fish <- do.call(rbind ,
                    
                    lapply (list_occ_fish, function (i)  
                      
                    
                        i %>% select (year,scientificName,Dataset) # interesting columns
  
                              
                       )) %>% 
  
                dcast (formula = year  ~scientificName, # table
                                  drop=T)# %>%
                        
                  
                 # set_rownames(.$year)   # set rownames

                    
                

# composition matrix
spp_year_fish <-  ifelse (spp_year_fish >=1,1,0)
spp_year_fish <- spp_year_fish [,-which(colnames(spp_year_fish) == "NA")]# rm NA cols

# aggregate
agg_data_year1_fish <- sum (spp_year_fish[1,-1]>0)
acc_time_fish <- lapply (seq (2,nrow(spp_year_fish)), function (i){
  
        agg_data <- aggregate (
               data.frame (spp_year_fish[1:i,]), 
                   by = list (spp_year_fish[1:i,"year"]),
                   FUN = sum)[,-c(1,2)]
        sum_sp <- sum (agg_data>0)
        sum_sp
})
acc_time_fish<- c(agg_data_year1_fish, unlist(acc_time_fish))
acc_time_fish <- data.frame(SR = acc_time_fish, 
           year = seq (2000,2022))
#acc_time_fish$year <- as.Date(as.character(acc_time_fish$year), format = "%Y")


# plot 
# benthos
trend_benthos_SR <- ggplot (data = acc_time, 
                            aes (x= (year),y=SR)) + 
  geom_area(alpha=0.5, fill = "#FD8235", col = "gray30",size=2) + 
  theme(plot.background = element_rect("#EBEBEB"),
        panel.background = element_blank(),
        axis.title = element_text(color = "#292929", face = "bold"),
        axis.text = element_text(color = "#292929", face = "bold"),
        panel.grid = element_blank()) + 
  xlab ("") + ylab ("") +
  
  # projects 
  geom_text_repel(data = begin_data, aes (x= min_year, y = 100,
                                                  label = Dataset,
                                                  angle = 270),
                                                  size = 3,
                                                  box.padding=0) + 
  geom_segment(data = begin_data, 
               aes(x = min_year, y = 0, xend = min_year, yend = 80)) + 
  
  # grants
  geom_segment(aes(x = 2011, y = -5, xend = 2014, yend = -5),size=3,col="gray30")+
  geom_segment(aes(x = 2013, y = 4, xend = 2022, yend = 4),size=3,col="gray60")+
  geom_segment(aes(x = 2020, y = 12, xend = 2022, yend = 12),size=3,col="#5A8F7B")

# fish
trend_fish_SR <- ggplot (data = acc_time_fish, aes (x=year,y=SR)) + 
  geom_area(alpha=0.5, fill = "#6CC4A1", col = "gray30",size=2) + 
  theme(plot.background = element_rect("#EBEBEB"),
        panel.background = element_blank(),
        axis.title.y = element_text(color = "#292929", face = "bold"),
        axis.text.y = element_text(color = "#292929", face = "bold"),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),# element_text(color = "#292929", face = "bold"),
        panel.grid = element_blank()) + 
  xlab ("") + ylab ("") +
  
  scale_y_reverse() + 
  # projects
  geom_text_repel(data = begin_data_fish, aes (x= min_year, y = 300,
                                                  label = Dataset,
                                                  angle = 270),
                                                  size = 3,
                                                  box.padding=0) + 
  geom_segment(data = begin_data_fish, 
               aes(x = min_year, y = 0, xend = min_year, yend = 300)) + 
  
  # grants
  geom_segment(aes(x = 2011, y = -10, xend = 2014, yend = -10),size=3,col="gray30")+
  geom_segment(aes(x = 2013, y = 13, xend = 2022, yend = 13),size=3,col="gray60")+
  geom_segment(aes(x = 2020, y = 40, xend = 2022, yend = 40),size=3,col="#5A8F7B")


# arrange plots
grid.arrange(trend_benthos_SR,
             trend_fish_SR,
             nrow=2,
              left = "Cumulative number of scientificNames")





# count the totals of taxa
# spp benthos
Ntaxa<-sum(is.na(unique(unlist(sapply (list_occ_benthos, "[[", "scientificName"))))!=T)
Nfam<-sum(is.na(unique(unlist(sapply (list_occ_benthos, "[[", "family"))))!=T)
Ncla<-sum(is.na(unique(unlist(sapply (list_occ_benthos, "[[", "class"))))!=T)
Nkin<-sum(is.na(unique(unlist(sapply (list_occ_benthos, "[[", "kingdom"))))!=T)
king_to_show<-unique(unlist(sapply (list_occ_benthos, "[[", "kingdom")))
king_to_show<- king_to_show[is.na(king_to_show)!=T]

# spp fish
Nspp <-sum(is.na(unique(unlist(sapply (list_occ_fish, "[[", "scientificName"))))!=T)
Nfamfish<-sum(is.na(unique(unlist(sapply (list_occ_fish, "[[", "family"))))!=T)
Nclafish<-sum(is.na(unique(unlist(sapply (list_occ_fish, "[[", "class"))))!=T)
fish_class <- unique(unlist(sapply (list_occ_fish, "[[", "class")))
fish_class <- fish_class[is.na(fish_class) !=T]
fish_kin <- unique(unlist(sapply (list_occ_fish, "[[", "kingdom")))


# fish to show
ranks <- unique(unlist(sapply (list_occ_fish, "[[", "taxonRank")))
# list of taxa
list_taxa_show <- lapply (list_occ_fish, function (i) # for each dataset
  lapply ( ranks, function (k) { # for each rank

    
    taxa_to_show <- unique(i[which(i$taxonRank %in% k),"scientificName"])# get the name

    taxa_to_show <- taxa_to_show[order(taxa_to_show)] # order

    taxa_to_show <- knitr::combine_words(taxa_to_show, and = "") # separate with commas
    taxa_to_show
  }))


# benthos to show

ranks_benthos <- unique(unlist(sapply (list_occ_benthos, "[[", "taxonRank")))
# list of taxa
list_taxa_show_benthos <- lapply (list_occ_benthos, function (i) # for each dataset
  lapply ( ranks_benthos, function (k) { # for each rank

    
    taxa_to_show <- unique(i[which(i$taxonRank %in% k),"scientificName"])# get the name

    taxa_to_show <- taxa_to_show[order(taxa_to_show)] # order

    taxa_to_show <- knitr::combine_words(taxa_to_show, and = "") # separate with commas
    taxa_to_show
  }))




```
Fig. 4: Trends in the number of scientific names accumulated over time for benthos (top) and fish (bottom). The vertical segments depict the year in which data included in each Dataset started to be collected. The horizontal bars depict the formal funding as follows: dark gray bar: Sisbiota, CNPq; light gray bar: PELD, CNPq; green bar: ReefSYN, Sinbiose CNPq. 


# Quality assurance/quality control procedures 

We used the following procedures: 

- The name of all taxa were checked against the WoRMS database, using the R package "worrms" (World Register of Marine Species (WoRMS, 2022)).
- Samples were always collected by researchers or trained students.
- Sampling methods are widely used and accepted by researchers.
- Data were checked by two data managers (A.L. Luza, C. Cordeiro) and questions were sent to data holders whenever necessary.
- All data were organized, standardized and processed using the R Programming Environment (R Core Team, 2022).
- R routines (scripts) are available at GitHub, together with raw data. 
_ This paper's draft was written in RMarkdown to ensure consistency between the data being presented, the data analysis, and the output (figures, tables).
- Were Softwares used to identify benthos always the same?

## Data management and standardization

We strive to standardize data and follow the FAIR principles of data science -- i.e. data should be "findable", "accessible", "interoperable", and "reusable" (Wilkinson et al., 2016). Data holders supplied their datasets to the database manager in digital format (e.g., spreadsheets, csv files). 


## Data structure

All datasets are available as a Darwin Core Archive (DwC-A), and all fields were named compliant with Darwin Core (DwC) standards (TDWG, 2015), which includes an event core (event sampling data), occurrence (taxonomic data), and extended measurement or fact (environmental variables and taxa counts or cover) (Fig. 5).


## Taxonomic coverage

General taxonomic coverage description: The five benthic datasets comprise the description of the occurrence of `r Ntaxa` taxa from `r Nfam` families, `r Ncla`, and `r Nkin` kingdoms, being them `r king_to_show`. The seven fish datasets comprise the description of the occurrence of `r Nspp` taxa from `r Nfamfish` families and `r Nclafish` classes, being them `r fish_class`.


# Taxonomic coverage per dataset

# Fish

Dataset I

*Taxonomic ranks*

Kingdom: `r unique(list_occ_fish[[1]]$kingdom)`

Phylum: Chordata

Class: `r knitr::combine_words(unique(list_occ_fish[[1]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_fish[[1]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Family: `r list_taxa_show[[1]][[5]]`

Genera: `r list_taxa_show[[1]][[2]]` 

Species: `r list_taxa_show[[1]][[1]]` 

Subspecies: `r list_taxa_show[[1]][[4]]`



Dataset II

*Taxonomic ranks*

Kingdom: `r unique(list_occ_fish[[2]]$kingdom)`

Phylum: Chordata

Class: `r knitr::combine_words(unique(list_occ_fish[[2]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_fish[[2]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Family: `r list_taxa_show[[2]][[5]]`

Genera: `r list_taxa_show[[2]][[2]]` 

Species: `r list_taxa_show[[2]][[1]]` 

Subspecies: `r list_taxa_show[[2]][[4]]`



Dataset III

*Taxonomic ranks*

Kingdom: `r unique(list_occ_fish[[3]]$kingdom)`

Phylum: Chordata

Class: `r knitr::combine_words(unique(list_occ_fish[[3]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_fish[[3]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Family: `r list_taxa_show[[3]][[5]]` 

Genera: `r list_taxa_show[[3]][[2]]` 

Species: `r list_taxa_show[[3]][[1]]` 

Subspecies: `r list_taxa_show[[3]][[4]]`



Dataset IV

*Taxonomic ranks*

Kingdom: `r unique(list_occ_fish[[4]]$kingdom)`

Phylum: Chordata

Class: `r knitr::combine_words(unique(list_occ_fish[[4]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_fish[[4]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Family: `r list_taxa_show[[4]][[5]]`

Genera: `r list_taxa_show[[4]][[2]]` 

Species: `r list_taxa_show[[4]][[1]]` 

Subspecies: `r list_taxa_show[[4]][[4]]`



Dataset V

*Taxonomic ranks*

Kingdom: `r unique(list_occ_fish[[5]]$kingdom)`

Phylum: Chordata

Class: `r knitr::combine_words(unique(list_occ_fish[[5]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_fish[[5]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Family: `r list_taxa_show[[5]][[5]]` 

Genera: `r list_taxa_show[[5]][[2]]` 

Species: `r list_taxa_show[[5]][[1]]` 

Subspecies: `r list_taxa_show[[5]][[4]]`



Dataset VI

*Taxonomic ranks*

Kingdom: `r unique(list_occ_fish[[6]]$kingdom)`

Phylum: Chordata

Class: `r knitr::combine_words(unique(list_occ_fish[[6]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_fish[[6]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Family: `r list_taxa_show[[6]][[5]]` 

Genera: `r list_taxa_show[[6]][[2]]` 

Species: `r list_taxa_show[[6]][[1]]` 

Subspecies: `r list_taxa_show[[6]][[4]]`



Dataset VII

*Taxonomic ranks*

Kingdom: `r unique(list_occ_fish[[7]]$kingdom)`

Phylum: Chordata

Class: `r knitr::combine_words(unique(list_occ_fish[[7]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_fish[[7]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Family: `r list_taxa_show[[7]][[5]]`  

Genera: `r list_taxa_show[[7]][[2]]` 

Species: `r list_taxa_show[[7]][[1]]` 

Subspecies: `r list_taxa_show[[7]][[4]]`



# Benthos

Dataset I

*Taxonomic ranks*

Kingdom: `r unique(list_occ_benthos[[1]]$kingdom)`

Phylum: 

Class: `r knitr::combine_words(unique(list_occ_benthos[[1]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_benthos[[1]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Phylum (Division): `r list_taxa_show_benthos[[1]][[9]]` 

Phylum: `r list_taxa_show_benthos[[1]][[6]]` 

Subphylum: `r list_taxa_show_benthos[[1]][[10]]` 

Class: `r list_taxa_show_benthos[[1]][[8]]` 

Subclass: `r list_taxa_show_benthos[[1]][[3]]` 

Order: `r list_taxa_show_benthos[[1]][[1]]` 

Subfamily: `r list_taxa_show_benthos[[1]][[4]]`

Genera: `r list_taxa_show_benthos[[1]][[7]]` 

Species: `r list_taxa_show_benthos[[1]][[2]]` 



Dataset II

*Taxonomic ranks*

Kingdom: `r unique(list_occ_benthos[[2]]$kingdom)`

Phylum: 

Class: `r knitr::combine_words(unique(list_occ_benthos[[2]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_benthos[[2]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Phylum (Division): `r list_taxa_show_benthos[[2]][[9]]` 

Phylum: `r list_taxa_show_benthos[[2]][[6]]` 

Subphylum: `r list_taxa_show_benthos[[2]][[10]]` 

Class: `r list_taxa_show_benthos[[2]][[8]]` 

Subclass: `r list_taxa_show_benthos[[2]][[3]]` 

Order: `r list_taxa_show_benthos[[2]][[1]]` 

Subfamily: `r list_taxa_show_benthos[[2]][[4]]`

Genera: `r list_taxa_show_benthos[[2]][[7]]` 

Species: `r list_taxa_show_benthos[[2]][[2]]` 



Dataset III

*Taxonomic ranks*

Kingdom: `r unique(list_occ_benthos[[3]]$kingdom)`

Phylum: 

Class: `r knitr::combine_words(unique(list_occ_benthos[[3]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_benthos[[3]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Phylum (Division): `r list_taxa_show_benthos[[3]][[9]]` 

Phylum: `r list_taxa_show_benthos[[3]][[6]]` 

Subphylum: `r list_taxa_show_benthos[[3]][[10]]` 

Class: `r list_taxa_show_benthos[[3]][[8]]` 

Subclass: `r list_taxa_show_benthos[[3]][[3]]` 

Order: `r list_taxa_show_benthos[[3]][[1]]` 

Subfamily: `r list_taxa_show_benthos[[3]][[4]]`

Genera: `r list_taxa_show_benthos[[3]][[7]]` 

Species: `r list_taxa_show_benthos[[3]][[2]]` 



Dataset IV

*Taxonomic ranks*

Kingdom: `r unique(list_occ_benthos[[4]]$kingdom)`

Phylum: 

Class: `r knitr::combine_words(unique(list_occ_benthos[[4]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_benthos[[4]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Phylum (Division): `r list_taxa_show_benthos[[4]][[9]]` 

Phylum: `r list_taxa_show_benthos[[4]][[6]]` 

Subphylum: `r list_taxa_show_benthos[[4]][[10]]` 

Class: `r list_taxa_show_benthos[[4]][[8]]` 

Subclass: `r list_taxa_show_benthos[[4]][[3]]` 

Order: `r list_taxa_show_benthos[[4]][[1]]` 

Subfamily: `r list_taxa_show_benthos[[4]][[4]]`

Genera: `r list_taxa_show_benthos[[4]][[7]]` 

Species: `r list_taxa_show_benthos[[4]][[2]]` 



Dataset V

*Taxonomic ranks*

Kingdom: `r unique(list_occ_benthos[[5]]$kingdom)`

Phylum: 

Class: `r knitr::combine_words(unique(list_occ_benthos[[5]]$class), and = "")`

Orders:

Families: `r knitr::combine_words(unique(list_occ_benthos[[5]]$family), and = "")`

*Taxa in the dataset (per identification level/at the identification level)*

Phylum (Division): `r list_taxa_show_benthos[[5]][[9]]` 

Phylum: `r list_taxa_show_benthos[[5]][[6]]` 

Subphylum: `r list_taxa_show_benthos[[5]][[10]]` 

Class: `r list_taxa_show_benthos[[5]][[8]]` 

Subclass: `r list_taxa_show_benthos[[5]][[3]]` 

Order: `r list_taxa_show_benthos[[5]][[1]]` 

Subfamily: `r list_taxa_show_benthos[[5]][[4]]`

Genera: `r list_taxa_show_benthos[[5]][[7]]` 

Species: `r list_taxa_show_benthos[[5]][[2]]` 


# Data availability
These data are published under CC BY-NC licence. 
"Policy of data sharing and use" can be found in the ReefSYN Organization in Github (available [here::here](https://github.com/Sinbiose-Reefs/reefsyn_site/blob/master/DataPolicy_SINBIOSE.pdf)). Data embargo goes up to **January 2024**, one year after the end of ReefSYN funding.



## Acknowledgements

This project is funded by the Center for Synthesis in Biodiversity and Ecosystem Services  [SinBiose](http://www.sinbiose.cnpq.br/web/sinbiose) (CNPq #442417/2019-5, granted to MGB). The center is part of the National Council for Scientific and Technological Development (*Conselho Nacional de Desenvolvimento Científico e Tecnológico*, CNPq).Researchers from the "Brazilian Marine Biodiversity Research Network – SISBIOTA-Mar" (CNPq #563276/2010-0 and FAPESC #6308/2011-8 to SRF) and ‘‘Programa de Monitoramento de Longa Duração das Comunidades Recifais de Ilhas Oceânicas – PELD ILOC’’ (CNPq 441241/2016-6, to CELF), initiatives that collected and shared their data sets used in this research. ALL acknowledge the funding of CNPq (#164240/2021-7, #151228/2021-3, #152410/2020-1). GOL is grateful to a research productivity scholarship provided by the Brazilian National Council for Scientific and Technological Development (CNPq; 310517/2019-2) and Serrapilheira Institute (Grant No. Serra-1708-15364) for continued research support. 


### References

Briggs, J.C. (1974). Marine zoogeography. McGraw-Hill, New York.

Darwin Core Task Group. 2009. Darwin Core. Biodiversity Information Standards (TDWG) http://www.tdwg.org/standards/450

Michener WK, Jones MB. Ecoinformatics: supporting ecology as a data-intensive science. Trends Ecol Evol. 2012 Feb;27(2):85-93. doi: 10.1016/j.tree.2011.11.016. Epub 2012 Jan 10. PMID: 22240191.

Reichman OJ, Jones MB, Schildhauer MP. Challenges and opportunities of open data in ecology. Science. 2011 Feb 11;331(6018):703-5. doi: 10.1126/science.1197962. PMID: 21311007.

UNESCO, 2021. UNESCO Recommendation on Open Science. Available at: https://unesdoc.unesco.org/ark:/48223/pf0000379949. 34 pages

Krajewski, J.P., Floeter, S.R. Reef fish community structure of the Fernando de Noronha Archipelago (Equatorial Western Atlantic): the influence of exposure and benthic composition. Environ Biol Fish 92, 25 (2011). https://doi.org/10.1007/s10641-011-9813-3