---
title:  "Standardized datasets of Brazilian reef diversity in space and time"
author: "Reef Synthesis Working Group; Luza, AL, Cordeiro, CAMM, ..., Aued, AW, Ferreira, CEL, Floeter, SR, Francini-Filho, RB, Longo, GO, Mendes, T., Roos, N, Segal, B, Bender, MG"
date: "2023/02/06"
output: github_document #github_document #  
---


<!-- README.md is generated from README.Rmd. Please edit that file -->

<!-- badges: start -->
<!-- badges: end -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# 1 Introduction

The recent rise of ecological synthesis has two main reasons: ecology is both entering in the age of big data (Michener & Jones 2012), and is increasingly applying the principles of open science (UNESCO 2021, Reichman et al. 2011). We are now experiencing a transition from isolated research, with data stored locally, to a global research network with data stored in public repositories and promptly available to foster further research (Reichman et al. 2011). Brazil has just started to follow this trend. For example, The ‘SinBiose’, the Center for Synthesis in Biodiversity and Ecosystem Services (see <http://www.sinbiose.cnpq.br/web/sinbiose/home>), is the first ecological synthesis center in Brazil and Latin America and brings innovative ideas about data synthesis and application of open-science principles (Luza et al., in prep.). Currently, seven working groups are funded by SinBiose, from which ReefSYN –**Reef Synthesis Working Group**– is the only one developing research on marine ecosystems, particularly on biogenic and rocky reefs of the Brazilian marine biogeographical province (Briggs 1974).
The ReefSYN gathers 22 researchers (20 early-career and senior researchers, assisted by two post-doctoral researchers) from several countries and institutions (Fig. 1). Funding from  SinBiose (CNPq) has given the ReefSYN group the opportunity to gather scientists of different areas of expertise, assemble data and develop ecological synthesis with a common objective: *to investigate the patterns and drivers of reef biodiversity and the provision of reef ecosystem  services in Brazil* (see <https://reefsyn.weebly.com/home-us.html>).
Curating available datasets to a common, globally accepted standard –the Darwin Core Standard–  would enable synthesis to answer ambitious questions on drivers of diversity and functioning of Brazilian reef ecosystems, and quantifying/ assessing anthropogenic impacts on reef biodiversity and ecosystem services. Adequate data standardization and storage enable data to be findable, accessible, interoperable and reusable (the ‘FAIR’ principles, Wilkinson et al. 2016) such that data can be integrated with pre-existing datasets by researchers and/or machine-learning algorithms. Following these principles we hereby present and characterize the 12 datasets gathered by ReefSYN (seven of fish and five of benthos), showing summaries of spatial distribution, sampling effort and methods, gain of data over time, and taxonomic coverage of data.


```{r, echo = F, fig.height=6.5,fig.width=6.5,fig.margin=F,fig.align="center", message=F,warning=F,out.width="80%",out.height="80%",dpi=600}


## R code to load data sets and plot points
## call packages

source("R/packages.R")
source("R/functions.R")

# open researcher data
researcher_data <- read.xlsx(here::here("Data","researcher_data","PLANILHA_CONSOLIDADA.xlsx"), sheet = 1, colNames = TRUE, detectDates=F)
# formatting data
researcher_data$objetivos <- as.character (researcher_data$objetivos)
researcher_data$titulo_portugues <- as.character (researcher_data$titulo_portugues)
researcher_data$titulo_ingles <- as.character (researcher_data$titulo_ingles)

## extrair as colunas que desejo analaisar
institution <- strsplit(researcher_data$instituicao,",")
institution <- unlist(strsplit(unlist(institution), "/"))
institution <- gsub (" ","",institution)
# df for word-cloud
institution <- data.frame (inst=unique(institution) [order (unique(institution))],
                           freq=table(institution) [order (names(table(institution)))])

# map institutions

## maps
# mapa mundi
world <- ne_countries(scale = "medium", returnclass = "sf")
world$colour_Country <- ifelse (world$name_sort %in% researcher_data$country, "orange","gray90")

# cortar o mapa para ver a america do Sul e parte da central
wm <- ggplot() + 
  geom_sf (data=world, size = 0.1, 
           fill= world$colour_Country,
           colour="gray40") +
  #coord_sf (xlim = c(-50, -25),  ylim = c(-30, 4), expand = FALSE) +
  theme_bw() + #xlab ("Longitude")  + ylab ("Latitude") +
  theme(panel.border = element_blank(), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "#f4f9f9",#darkslategray1
                                        colour = "#f4f9f9"),
        axis.text.x = element_text(size=8),
        axis.ticks.x=element_line(size=1),
        axis.text.y = element_text(size=8),
        axis.ticks.y=element_line(size=1),
        axis.title.x = element_text(size=10),
        axis.title.y = element_text(size=10),
        #title = element_blank(),
        plot.margin = unit(c(0,-0.8,0,0.3), "cm")) +
  labs (title = "Institutions of ReefSYN team members")


# map
map_SC <- wm + geom_point(data  = researcher_data %>%
                                    select (instituicao, lat,long) %>%
                                    group_by(instituicao) %>%
                            summarise (lat = mean(lat),
                                       long=mean(long)),aes (x=long,y=lat), 
                size=3) + 
  geom_label_repel(data = researcher_data%>%
                                    select (instituicao, lat,long) %>%
                                    group_by(instituicao) %>%
                            summarise (lat = mean(lat),
                                       long=mean(long)), aes(x=long, 
                                  y=lat,
                                  label = instituicao),
                  size = 3,
                  fill = "white",
                  alpha=0.8,
                  min.segment.length = 0,
                  box.padding = 0.3,
                  max.overlaps=100)+
  xlab("") + ylab("") + 
  theme(legend.position = "none") 



### titulo em ingles
titulo_ingles <- as.character (researcher_data$titulo_ingles [which(researcher_data$titulo_ingles != "Indefinido")])
## gerar df para o wcloud
freq_texto_wc <-  function_freq_texto_wc (titulo_ingles)

par(mar = c(4, 4, .1, .1))

## institutions

#wordcloud::wordcloud(words = institution$inst, freq = institution$freq.Freq,
#          min.freq = 1,scale=c(4, .2),
#          max.words=50, 
#          random.order=FALSE, rot.per=0.15, 
#          colors = RColorBrewer::brewer.pal(8, "Dark2"))
#


map_SC

# title english
wordcloud::wordcloud(words = freq_texto_wc$word, 
          freq = freq_texto_wc$freq.Freq,
          min.freq = 2,scale=c(4, .2),
          max.words=max(freq_texto_wc$freq.Freq)+3, 
          random.order=FALSE, rot.per=0.15, 
          colors = RColorBrewer::brewer.pal(8, "Dark2"))



```
Fig. 1: Institutions and research topics explored by the ReefSYN team members.


# 2 Methodology

## 2.1 Geographical and temporal coverage

From 2001 up to 2020, we gathered data on fish and benthic organisms (e.g., algae, corals) in more than 400 sites distributed throughout the Brazilian coast and oceanic islands (Fig. 2, Tables 1 and 2). All these data came from geographically replicated, large-scale and long-term ecological monitoring research programs conducted over the last decades in Brazil (SISBOTA-MAR, PELD-ILOC, Abrolhos Bank monitoring), and from novel initiatives such as the monitoring of reef fish and benthos of Rio Grande do Norte (e.g., Ross et al. 2019).
The Brazilian marine biogeographical province (Briggs, 1974; Floeter et al., 2008; Pinheiro et al., 2018), located in Southwestern Atlantic, host reefs with mostly turbid and nutrient-rich waters due to the sediment discharge from several rivers that flow into the coast (Aued et al., 2018; Loiola et al., 2019; Mies et al., 2020).Coral and rocky reefs are disposed along more than 27 latitude degrees in the narrow continental shelf (0.91N to 27.6S latitude degrees; Fig. 3). These reefs are exposed to varied temperature, productivity and salinity settings, producing a north/northeast and south/southeast regionalization of the coastal biodiversity (Cord et al., 2022; Pinheiro et al., 2018). Far from the coast there are four oceanic islands, which host coralligenous and rocky reefs, with high endemism levels, and a varied similarity in species composition to that of coastal reefs (Cord et al., 2022; Pinheiro et al., 2018). Recent analysis of spatially extensive benthic datasets revealed clear-water reef communities occurring in the oceanic islands and in oligotrophic waters from the Northeast region, whereas turbid-water reef communities occurring throughout the coast (Santana et al. 2023).
The sampling effort available in the current datasets was not evenly distributed in time. Indeed, since 2001, the number of samples accumulated over time, as well as the number of sampled taxa (Fig. 2). There was a notable increase in sampling effort after 2012-2013, which is associated with the Sisbiota-Mar network, the increase in team members, aggregation of datasets, and the total amount of financial support derived from network cooperative efforts/partners. The ProspeqMar project, for example, which has bioprospection and holobiotic investigation objectives, has been an important contribution to network maintenance from 2013 onwards.
Notably, the cumulative number of eventIDs (i.e. information associated with a sampling event-- i.e. something that occurs at a place and time-- Darwin Core Task Group (2009)) over time across the datasets show that i) there was an abrupt increase in the number of eventIDs after 2013, mainly for benthos (leveraged by the Sisbiota-Mar project (CNPq)), ii) large projects such as Sisbiota-Mar and PELD ILOC have already made an effort to gather data from previous initiatives (Krajewski & Floeter 2011), iii) there was a nearly constant increase in the number of fish taxa over time. For benthos, in contrast, there were years of constancy amid years of abrupt increase in the number of identified taxa (Figs. 3 and 4), a delay probably caused by the laboratory and computational work required to identify these organisms.



```{r, echo = F, fig.height=8, fig.width=8, message=F, warning=F, fig.align= "center", out.width="100%", out.height="100%", dpi=600}

# load Datasets
# benthos
ds1<- read.csv (here::here("DwC_output", "AAued_spatialData", "event_core.csv"))
ds2<- read.csv (here::here("DwC_output", "GLongo_NRoss_spatialData", "event_core_benthos.csv"))
ds3<- read.table (here::here("DwC_output","PELD_iloc_benthos", "event_core.txt"),h=T,sep=",")
colnames(ds3)[which(colnames(ds3) == "island")] <- "site"
colnames(ds3)[which(colnames(ds3) == "eventYear")] <- "year"
ds3$higherGeography <- "BrazilianOceanicIslands"
ds4<- read.csv (here::here("DwC_output","RFrancini_spatialData", "event_core.csv"))
ds5<- read.csv (here::here("DwC_output","RFrancini_timeSeries_abrolhos","event_core_benthos.csv"))

# fish
ds6<- read.csv (here::here("DwC_output","GLongo_NRoss_spatialData", "event_core_fish.csv"))
ds7<- read.csv (here::here("DwC_output","GLongo_spatialData", "event_core.csv"))
ds8<- read.table (here::here("DwC_output","PELD_iloc_fish", "event_core.txt"),h=T, sep= ";")
colnames(ds8)[which(colnames(ds8) == "island")] <- "site"
colnames(ds8)[which(colnames(ds8) == "eventYear")] <- "year" # 
ds8 <- ds8 [which(ds8$site != "Ascension"),] # removing Ascension
ds8$higherGeography <- "BrazilianOceanicIslands"
ds9<- read.csv (here::here("DwC_output","RFrancini_timeSeries_abrolhos","event_core_fish.csv"))
ds10<- read.csv (here::here("DwC_output","RJ_time_series", "event_core.csv"))
ds11<- read.csv (here::here("DwC_output","RMorais_spatialData", "event_core.csv"))
ds12<- read.csv (here::here("DwC_output","SC_time_series", "event_core.csv"))
ds13<- read.csv (here::here("DwC_output","Alcatrazes_time_series", "event_core.csv"))

# list of sites with sampling of benthic communities
list_benthos <- list(data.frame (ds1, Dataset= "XI"),
                     data.frame (ds4, Dataset = "X"),
                     data.frame (ds3, Dataset ="XII"),
                     data.frame (ds2, Dataset="XIII"),
                     data.frame (ds5, Dataset = "IX"))



# agggregate and get coordinates for each site
coords <- lapply (list_benthos, function (i) 
  
  
  dplyr::group_by(i, Dataset, higherGeography, site, locality) %>% 
  
                    summarise(decimalLatitude = mean(decimalLatitude),
                            decimalLongitude = mean(decimalLongitude)) %>% 
    
                  select (higherGeography, site, locality,
                          decimalLatitude, decimalLongitude)
)

# melt
coords <- do.call(rbind, coords)
coords$Dataset <- factor (coords$Dataset,
                          levels =  c("IX", "X", "XI", "XII", "XIII"))
coords_unique_sites <- coords %>% 
  group_by(locality) %>%
  summarise(decimalLatitude = mean( decimalLatitude,na.rm=T),
                            decimalLongitude = mean( decimalLongitude,na.rm=T)) 

# map
# mapa mundi
world <- ne_countries(scale = "medium", returnclass = "sf")

# cortar o mapa para ver a america do Sul e parte da central
wm <- ggplot() + 
  geom_sf (data=world, size = 0.1, 
           fill= "gray90",colour="gray90") +
  coord_sf (xlim = c(-50, -25),  ylim = c(-30, 4), expand = FALSE) +
  theme_bw() + xlab ("Longitude")  + ylab ("Latitude") +
  theme(panel.border = element_blank(), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "#81C6E8",
                                        colour = "#81C6E8"),
        
        axis.text.x = element_text(size=6),
        axis.ticks.x=element_line(size=1),
        axis.text.y = element_text(size=6),
        axis.ticks.y=element_line(size=1),
        axis.title.x = element_text(size=8),
        axis.title.y = element_text(size=8),
        title = element_text(size=9)) 

# map
wm_data <- wm +  geom_jitter(data = coords, 
                             aes(x = decimalLongitude, 
                                 y = decimalLatitude,
                                 col = Dataset,
                                 fill=Dataset), 
                             size =4, position= "jitter",
                            stat = "identity",
        shape = 19, alpha=0.3,
        stroke=1) +
  theme (plot.background = element_rect("#EBEBEB"),
        #panel.background = element_blank(),
        axis.title = element_text(color = "#292929", face = "bold"),
        axis.text = element_text(color = "#292929", face = "bold"),
         legend.text = element_text(size =6),
        legend.title = element_text(size =7),
        legend.key.height= unit(0.3, 'cm'),
        legend.key.width= unit(0.1, 'cm'),
        panel.grid = element_blank())+
  scale_colour_viridis_d(option="magma", end=0.8)+
  ggtitle (paste ("Number of localities with benthic sampling", "n=", nrow(coords_unique_sites), sep=" "))  +
  guides(colour = guide_legend(override.aes = list(alpha=1)))


# ================
# fish

list_fish <- list(data.frame (ds11, Dataset = "I"),
                  data.frame (ds7, Dataset = "VI"),
                  data.frame (ds8, Dataset = "IV"),
                  data.frame (ds6, Dataset = "VIII"),
                  data.frame (ds12, Dataset = "V"),
                  data.frame (ds10, Dataset = "III"),
                  data.frame (ds9, Dataset = "II"),
                  data.frame (ds13, Dataset = "VII")
                  
                  
                  )


# agggregate and get coordinates for each site
coords_fish <- lapply (list_fish, function (i) 
  
  
  group_by(i, Dataset, higherGeography, site, locality) %>% 
  
                    summarise(decimalLatitude = mean( decimalLatitude,na.rm=T),
                            decimalLongitude = mean( decimalLongitude,na.rm=T)) %>% 
    
                  select (higherGeography,site, locality,
                          decimalLatitude,decimalLongitude)
)

# melt
coords_fish <- do.call(rbind,coords_fish)
coords_fish_unique_sites <- coords_fish %>% 
  group_by(locality) %>%
  summarise(decimalLatitude = mean( decimalLatitude,na.rm=T),
                            decimalLongitude = mean( decimalLongitude,na.rm=T)) 

# map
wm_data_fish <- wm + geom_point(data = data.frame(coords_fish), aes(x = decimalLongitude, 
                                                         y = decimalLatitude,
                                                         col = Dataset,
                                                         fill=Dataset), 
                            size =4, position= "jitter",
        shape = 19, alpha=0.3) + 
  scale_colour_viridis_d(direction=1)+
  theme (plot.background = element_rect("#EBEBEB"),
        #panel.background = element_blank(),
        axis.title = element_text(color = "#292929", face = "bold"),
        axis.text = element_text(color = "#292929", face = "bold"),
        legend.text = element_text(size =6),
        legend.title = element_text(size =7),
        legend.key.height= unit(0.3, 'cm'),
        legend.key.width= unit(0.1, 'cm'),
        panel.grid = element_blank())+
  ggtitle (paste ("Number of localities with fish sampling", "n=", nrow(coords_fish_unique_sites), sep=" ")) +
  guides(colour = guide_legend(override.aes = list(alpha=1))) 

# panel of maps
gridExtra::grid.arrange(
             wm_data_fish,
             wm_data,
             ncol=2)


# unique locality names
#unique(c(coords_fish_unique_sites$locality,
#coords_unique_sites$locality))

```
Fig. 2: Spatial distribution of fish (left) and benthos (right) sampling sites per dataset.


## 2.2 Data description

The datasets described here represent different efforts to gather data on reef fish and benthos along the Brazilian biogeographical province. We hereby present 12 datasets of reef fish (n=7) and benthos (n=5). Three out of seven fish datasets and two out of five benthic datasets are time series (Tables 1 and 2). The remaining datasets are spatial snapshots (only one visit to a site) whose data were collected over many years.


Table 1: Description of reef fish datasets.

```{r, echo = F, results='asis'}


# fish
table_description_data_fish <- lapply (list_fish, function (i)
  
    data.frame ("Sampling protocol" = (table(i$samplingProtocol)),
                "Dataset" = unique(i$Dataset),
                "Scale" = "Transect/plot",
                "Sampling area (m2)" = mean (i$sampleSizeValue),
                "Nsites" = length(unique(i$site)),
                "Latitude" = paste (round (min (i$decimalLatitude,na.rm=T),2),
                                    round (max (i$decimalLatitude,na.rm=T),2),
                                    sep=", "),
                "Longitude" = paste (round (min (i$decimalLongitude,na.rm=T),2),
                                    round (max (i$decimalLongitude,na.rm=T),2),
                                    sep=", "),
                "Years" = paste (round (min (i$year,na.rm=T),2),
                                    round (max (i$year,na.rm=T),2),
                                    sep="-"))
)

# melt
table_description_data_fish<-do.call(rbind,table_description_data_fish)

table_description_data_fish %>% 
  mutate(Sampling.protocol.Var1 = recode(Sampling.protocol.Var1, 
                                         "video plot - 2 x 1m" = "Video plot - 2 x 1m"
                                   )) %>% 
  dplyr::rename("Sampling Protocol" = "Sampling.protocol.Var1",
                "Samples (n)" = "Sampling.protocol.Freq",
                "Sampling area (m2)" = "Sampling.area..m2.",
                 "Number of sites" = "Nsites") %>% 
  


  dplyr::relocate("Dataset") %>%
  
  kable(align="c")



```


Table 2: number of sampling events of benthos sampling, per dataset.

```{r, echo = F, results='asis'}

## Benthos
# the number of sampling events per dataset

table_description_data_benthos <- lapply (list_benthos, function (i)
  
    data.frame ("Sampling protocol" = table(i$samplingProtocol),
                "Dataset" = unique(i$Dataset),
                "Scale" = "Plot/point",
                "Sampling area (m2)" = round (mean (i$sampleSizeValue),2),
                "Nsites" = length(unique(i$site)),
                "Latitude" = paste (round (min (i$decimalLatitude),2),
                                    round (max (i$decimalLatitude),2),
                                    sep=", "),
                "Longitude" = paste (round (min (i$decimalLongitude),2),
                                    round (max (i$decimalLongitude),2),
                                    sep=", "),
                "Years" = paste (round (min (i$year,na.rm=T),2),
                                    round (max (i$year,na.rm=T),2),
                                    sep="-"))
)

# melt
table_description_data_benthos <- do.call(rbind,table_description_data_benthos)
#sum(table_description_data_benthos$eventIDs)

table_description_data_benthos %>%
  #dplyr::mutate(Sampling.protocol.Var1 = recode(Sampling.protocol.Var1, 
  #                                              "point-intercept  lines" = "Point-intercept lines - 10m",
  #                                              "photoquadrats" = "Photoquadrats - 1 x 1m",
  #                                              "fixed photo-quadrats" = "Photoquadrats - 1 x 1m",
  #                                              "Photoquadrats 50 X 50cm" = "Photoquadrats - 0.5 x 0.5m"))  %>%
  #
  dplyr::rename("Sampling Protocol" = "Sampling.protocol.Var1",
                "Samples (n)" = "Sampling.protocol.Freq",
                "Sampling area (m2)" = "Sampling.area..m2.",
                 "Number of sites" = "Nsites") %>%
  
     
     
     
  dplyr::relocate("Dataset") %>%
  kable(align="c")




```





<!-- badges: start -->
<!-- badges: end -->


```{r, echo = F, fig.height=5,fig.width=8,message=F, warning=F,fig.align= "center",dpi=600,out.width="100%",out.height="100%"}


# benthos
# number of eventIDs (rows per year)
eventIDs_year <- lapply (list_benthos, function (i) i %>% 
                           group_by (year,Dataset) %>% 
                           tally()  # the number of eventIDs
                         
                         )
# count the ids
eventIDs_year_benthos<-do.call(rbind,eventIDs_year) %>%
                           
                          group_by(year) %>%
                           
                          summarise (sum_cum = sum (n)) %>% # sum the number of ids per year
                          mutate(n_cum = cumsum(sum_cum)) # find the cumulative sum

# the beggining of each Dataset
begin_data <- do.call(rbind,eventIDs_year) %>%
                           
                          group_by(Dataset) %>%
                          
                          summarise (min_year = min (year,na.rm=T)) 


# fish
# number of eventIDs (rows per year)
eventIDs_yearB <- lapply (list_fish, function (i) i %>% 
                           group_by (year,Dataset) %>% 
                           tally()  # the number of eventIDs
                         
                         )
# count the ids
eventIDs_year_fish<-do.call(rbind,eventIDs_yearB) %>%
                           
                          group_by(year) %>%
                           
                          summarise (sum_cum = sum (n)) %>% # sum the number of ids per year
                          mutate(n_cum = cumsum(sum_cum)) # find the cumulative sum

# the beggining of each Dataset
begin_data_fish <- do.call(rbind,eventIDs_yearB) %>%
                           
                          group_by(Dataset) %>%
                          
                          summarise (min_year = min (year,na.rm=T)) 


# bind the years in the fish Dataset missing in the benthic Datasets
to_bind_benthos <- data.frame (year = c(2001, 2002,2020,2021,2022),
                               sum_cum=c(0,0,max(eventIDs_year_benthos$sum_cum),
                                          max(eventIDs_year_benthos$sum_cum),
                                          max(eventIDs_year_benthos$sum_cum)),
                               n_cum=c(0,0,max(eventIDs_year_benthos$n_cum),
                                       max(eventIDs_year_benthos$n_cum),
                                       max(eventIDs_year_benthos$n_cum)))

# bind
eventIDs_year_benthos <- bind_rows (eventIDs_year_benthos,
                                    to_bind_benthos) %>% 
  
              arrange (year)


# plot 
# benthos
trend_benthos <- ggplot (data = eventIDs_year_benthos, aes (x=year,y=n_cum)) + 
  geom_area(alpha=0.5, fill = "#FD8235", col = "gray30",size=1) + 
  theme(plot.background = element_rect("#EBEBEB"),
        panel.background = element_blank(),
        axis.title = element_text(color = "#292929", face = "bold",size=12),
        axis.text = element_text(color = "#292929", face = "bold",size=12),
        panel.grid = element_blank()) + 
  xlab ("") + ylab ("") 

trend_benthos_annotate <- trend_benthos + geom_text(data = begin_data, aes (x= min_year, y = 2000,
                                                  label = Dataset,
                                                  angle = 0),
                                                  size = 5) + 
  geom_segment(data = begin_data, 
               aes(x = min_year, y = 0, xend = min_year, yend = 1500)) + 
  geom_segment(aes(x = 2011, y = -100, xend = 2014, yend = -100),size=3,col="gray30")+
  geom_segment(aes(x = 2013, y = 100, xend = 2022, yend = 100),size=3,col="gray60")+
  geom_segment(aes(x = 2020, y = 300, xend = 2022, yend = 300),size=3,col="#5A8F7B")

# fish
trend_fish <- ggplot (data = eventIDs_year_fish, aes (x=year,y=n_cum)) + 
  geom_area(alpha=0.5, fill = "#6CC4A1", col = "gray30",size=1) + 
  theme(plot.background = element_rect("#EBEBEB"),
        panel.background = element_blank(),
        axis.title.y = element_text(color = "#292929", face = "bold",size=12),
        axis.text.y = element_text(color = "#292929", face = "bold",size=12),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),# element_text(color = "#292929", face = "bold"),
        panel.grid = element_blank()) + 
  xlab ("") + ylab ("") 

trend_fish_annotate <- trend_fish + geom_text_repel(data = begin_data_fish, aes (x= min_year, y = 14000,
                                                  label = Dataset,
                                                  angle = 0),
                                                  size = 5,
                                                  box.padding=0) + 
  geom_segment(data = begin_data_fish, 
               aes(x = min_year, y = 0, xend = min_year, yend = 10000)) +
  geom_segment(aes(x = 2011, y = -400, xend = 2014, yend = -400),size=3,col="gray30")+
  geom_segment(aes(x = 2013, y = 500, xend = 2022, yend = 500),size=3,col="gray60")+
  geom_segment(aes(x = 2020, y = 1300, xend = 2022, yend = 1300),size=3,col="#5A8F7B")
#+
 # scale_y_reverse()


gridExtra::grid.arrange (
              trend_fish_annotate,
              trend_benthos_annotate,
              nrow=2,
              left = "Cumulative number of sampling events (eventIDs)") 



```
Fig. 3: The number of sampling events accumulated over time for fish (top) and benthos (bottom). One sampling event consists, for example, on one transect deployed into a locality. The vertical segments indicate the year in which data included in each dataset started to be collected. The horizontal bars depict the main funding sources as follows: dark gray bar: Sisbiota, CNPq; light gray bar: PELD, CNPq; green bar: ReefSYN, SinBiose CNPq.




```{r, echo = F, fig.height=5,fig.width=8,message=F, dpi=600, warning=F, fig.align= "center",out.width="100%",out.height="100%"}

# load Datasets
# benthos
ds1_occ<- read.csv (here::here("DwC_output","AAued_spatialData", "DF_occ.csv"))
ds1_occ$year<- ds1 [match (ds1_occ$eventID, ds1$eventID), "year"]
ds2_occ<- read.csv (here::here("DwC_output","GLongo_NRoss_spatialData", "DF_occ_benthos.csv"))
ds2_occ$year<- ds2 [match (ds2_occ$eventID, ds2$eventID), "year"]

ds3_occ<- read.table (here::here("DwC_output","PELD_iloc_benthos", "DF_occ.txt"), sep = ",",h=T) # no meu pc, sep = ";"
ds3_occ$year<- ds3 [match (ds3_occ$eventID, ds3$eventID), "year"] 
## PROBLEMA -> eventID ESTA COM FORMATO ERRADO (PARTES REPETIDAS, ex. BR:PELD-ILOC:Noronha_Ponta_da_Sapata_2017_noronhaponta_da_sapata2017fundoT1Q7PS_2017_FUNDO_T1_Q7)
colnames(ds3_occ)[which(colnames(ds3_occ) == "island")] <- "site"
colnames(ds3_occ)[which(colnames(ds3_occ) == "eventYear")] <- "year"
ds3_occ$higherGeography <- "BrazilianOceanicIslands"

ds4_occ<- read.csv (here::here("DwC_output","RFrancini_spatialData", "DF_occ.csv"))
ds4_occ$year<- ds4 [match (ds4_occ$eventID, ds4$eventID), "year"]
ds5_occ<- read.csv (here::here("DwC_output","RFrancini_timeSeries_abrolhos","DF_occ_benthos.csv"))
ds5_occ$year<- ds5 [match (ds5_occ$eventID, ds5$eventID), "year"]

# fish

ds6_occ<- read.csv (here::here("DwC_output","GLongo_NRoss_spatialData", "DF_occ_fish.csv"))
ds6_occ$year<- ds6 [match (ds6_occ$eventID, ds6$eventID), "year"]
ds7_occ<- read.csv (here::here("DwC_output","GLongo_spatialData", "DF_occ.csv"))
ds7_occ$year<- ds7 [match (ds7_occ$eventID, ds7$eventID), "year"]
ds8_occ<- read.table (here::here("DwC_output","PELD_iloc_fish", "DF_occ.txt"), h=T, sep = ";")
ds8_occ$higherGeography <- "BrazilianOceanicIslands"
ds8_occ$year<- ds8 [match (ds8_occ$eventID, ds8$eventID), "year"]
ds9_occ<- read.csv (here::here("DwC_output","RFrancini_timeSeries_abrolhos","DF_occ_fish.csv"))
ds9_occ$year<- ds9 [match (ds9_occ$eventID, ds9$eventID), "year"]
ds10_occ<- read.csv (here::here("DwC_output","RJ_time_series", "DF_occ.csv"))
ds10_occ$year<- ds10 [match (ds10_occ$eventID, ds10$eventID), "year"]
ds11_occ<- read.csv (here::here("DwC_output","RMorais_spatialData", "DF_occ.csv"))
ds11_occ$year<- ds11 [match (ds11_occ$eventID, ds11$eventID), "year"]
ds12_occ<- read.csv (here::here("DwC_output","SC_time_series", "DF_occ.csv"))
ds12_occ$year<- ds12 [match (ds12_occ$eventID, ds12$eventID), "year"]
ds13_occ<- read.csv (here::here("DwC_output","Alcatrazes_time_series", "DF_occ.csv"))
ds13_occ$year<- ds12 [match (ds13_occ$eventID, ds13$eventID), "year"]


# list of sites with sampling of benthic communities

list_occ_benthos <- list(data.frame (ds1_occ, Dataset= "XI"),
                     data.frame (ds4_occ, Dataset = "X"),
                     data.frame (ds3_occ, Dataset ="XII"),
                     data.frame (ds2_occ, Dataset="XIII"),
                     data.frame (ds5_occ, Dataset = "IX")
)



# ================
# fish

list_occ_fish <- list(data.frame (ds11_occ, Dataset = "I"),    
                  data.frame (ds7_occ, Dataset = "VI"),
                  data.frame (ds8_occ, Dataset = "IV"),
                  data.frame (ds6_occ, Dataset = "VIII"),
                  data.frame (ds12_occ, Dataset = "V"),
                  data.frame (ds10_occ, Dataset = "III"),
                  data.frame (ds9_occ, Dataset = "II"),
                  data.frame (ds13_occ, Dataset = "VII")
                  
                  )

 
## project richness

# benthos
# number of spp year (rows per year)

spp_year <- do.call(rbind,
                    
                    lapply (list_occ_benthos, function (i)  
                      
                    
                        i %>% select (year, scientificNameAccepted, Dataset) # interesting columns
  
                              
                       )) %>% 
  
                dcast (formula = year ~ scientificNameAccepted, # table
                                  drop=T) %>%
                        
                  
                  set_rownames(.$year)  # set rownames
  
                    
                

# composition matrix
spp_year <-  ifelse (spp_year >=1,1,0)
#spp_year <- spp_year [,-which(colnames(spp_year) == "NA")]# rm NA cols


# aggregate
agg_data_year1 <- sum (spp_year[1,-1]>0)
acc_time <- lapply (seq (2,nrow(spp_year)), function (i){
  
        agg_data <- aggregate (
               data.frame (spp_year[1:i,]), 
                   by = list (spp_year[1:i,"year"]),
                   FUN = sum)[,-c(1,2)]
        sum_sp <- sum (agg_data>0)
        sum_sp
})
acc_time<- c(agg_data_year1, unlist(acc_time))
acc_time <- data.frame(SR = acc_time, 
           year = as.numeric(rownames(spp_year)))
acc_time<-rbind (acc_time,
                 data.frame  (SR=max(acc_time$SR), 
                              year=c(2020,2021,2022)))

# fish 

spp_year_fish <- do.call(rbind ,
                    
                    lapply (list_occ_fish, function (i)  
                      
                    
                        i %>% select (year, scientificNameAccepted, Dataset) # interesting columns
  
                              
                       )) %>% 
  
                dcast (formula = year ~ scientificNameAccepted, # table
                                  drop=T)

                    
                

# composition matrix
spp_year_fish <-  ifelse (spp_year_fish >=1,1,0)
spp_year_fish <- spp_year_fish [,-which(colnames(spp_year_fish) == "NA")]# rm NA cols

# aggregate
agg_data_year1_fish <- sum (spp_year_fish[1,-1]>0)
acc_time_fish <- lapply (seq (2,nrow(spp_year_fish)), function (i){
  
        agg_data <- aggregate (
               data.frame (spp_year_fish[1:i,]), 
                   by = list (spp_year_fish[1:i,"year"]),
                   FUN = sum)[,-c(1,2)]
        sum_sp <- sum (agg_data>0)
        sum_sp
})
acc_time_fish <- c(agg_data_year1_fish, unlist(acc_time_fish))
acc_time_fish <- data.frame(SR = acc_time_fish, 
           year = seq (2000, 2022))
#acc_time_fish$year <- as.Date(as.character(acc_time_fish$year), format = "%Y")


# plot 
# benthos
trend_benthos_SR <- ggplot (data = acc_time, 
                            aes (x= (year),y=SR)) + 
  geom_area(alpha=0.5, fill = "#FD8235", col = "gray30",size=1) + 
  theme(plot.background = element_rect("#EBEBEB"),
        panel.background = element_blank(),
        axis.title = element_text(color = "#292929", face = "bold",size=12),
        axis.text = element_text(color = "#292929", face = "bold",size=12),
        panel.grid = element_blank()) + 
  xlab ("") + ylab ("") +
  
  # projects 
  geom_text_repel(data = begin_data, aes (x= min_year, y = 80,
                                                  label = Dataset,
                                                  angle = 0),
                                                  size = 5,
                                                  box.padding=0) + 
  geom_segment(data = begin_data, 
               aes(x = min_year, y = 0, xend = min_year, yend = 60)) + 
  
  # grants
  geom_segment(aes(x = 2011, y = -5, xend = 2014, yend = -5),size=3,col="gray30")+
  geom_segment(aes(x = 2013, y = 4, xend = 2022, yend = 4),size=3,col="gray60")+
  geom_segment(aes(x = 2020, y = 12, xend = 2022, yend = 12),size=3,col="#5A8F7B")

# fish
trend_fish_SR <- ggplot (data = acc_time_fish, aes (x=year, y=SR)) + 
  geom_area(alpha=0.5, fill = "#6CC4A1", col = "gray30",size=1) + 
  theme(plot.background = element_rect("#EBEBEB"),
        panel.background = element_blank(),
        axis.title.y = element_text(color = "#292929", face = "bold",size=12),
        axis.text.y = element_text(color = "#292929", face = "bold",size=12),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),# element_text(color = "#292929", face = "bold"),
        panel.grid = element_blank()) + 
  xlab ("") + ylab ("") +
  
  #scale_y_reverse() + # talvez seja melhor manter a escala normal
  # projects
  geom_text_repel(data = begin_data_fish, aes (x= min_year, y = 250,
                                                  label = Dataset,
                                                  angle = 0),
                                                  size = 5,
                                                  box.padding=0) + 
  geom_segment(data = begin_data_fish, 
               aes(x = min_year, y = 0, xend = min_year, yend = 220)) + 
  
  # grants
  geom_segment(aes(x = 2011, y = -10, xend = 2014, yend = -10),size=3,col="gray30")+
  geom_segment(aes(x = 2013, y = 13, xend = 2022, yend = 13),size=3,col="gray60")+
  geom_segment(aes(x = 2020, y = 40, xend = 2022, yend = 40),size=3,col="#5A8F7B")


# arrange plots
gridExtra::grid.arrange(trend_fish_SR,
             trend_benthos_SR,
             nrow=2,
              left = "Cumulative number of scientificNameAccepted")


# count the totals of taxa
# spp benthos

benthic_taxa <-lapply (list_occ_benthos, function (i)


  (unique(i$scientificNameAccepted[which(i$taxonRank == "Species")])) # at the species level

)
Ntaxa <- length (unique(unlist(benthic_taxa)))
Ngenera <- sum(is.na(unique(unlist(sapply (list_occ_benthos, "[[", "genus"))))!=T)
Nfam<-sum(is.na(unique(unlist(sapply (list_occ_benthos, "[[", "family"))))!=T)
Ncla<-sum(is.na(unique(unlist(sapply (list_occ_benthos, "[[", "class"))))!=T)
Nkin<-sum(is.na(unique(unlist(sapply (list_occ_benthos, "[[", "kingdom"))))!=T)
king_to_show<-unique(unlist(sapply (list_occ_benthos, "[[", "kingdom")))
king_to_show<- king_to_show[is.na(king_to_show)!=T]

# spp fish
fish_taxa <-lapply (list_occ_fish, function (i)


  (unique(i$scientificNameAccepted[which(i$taxonRank == "Species")])) # at the species level

)
Nspp <- length (unique(unlist(fish_taxa)))
Species_fish <- unique(unlist(sapply (list_occ_fish, "[[", "scientificNameAccepted")))
Species_fish<- Species_fish[is.na(Species_fish) != T]
Ngenera <- length(unique(sapply (strsplit(Species_fish, " "), "[[",1)))
Nfamfish<-sum(is.na(unique(unlist(sapply (list_occ_fish, "[[", "family"))))!=T)
Nclafish<-sum(is.na(unique(unlist(sapply (list_occ_fish, "[[", "class"))))!=T)
fish_class <- unique(unlist(sapply (list_occ_fish, "[[", "class")))
fish_class <- fish_class[is.na(fish_class) !=T]
fish_kin <- unique(unlist(sapply (list_occ_fish, "[[", "kingdom")))
fish_kin <- fish_kin[is.na(fish_kin)!= T]

# fish to show
ranks <- unique(unlist(sapply (list_occ_fish, "[[", "taxonRank")))
ranks <- ranks[is.na(ranks) != T]

# list of taxa
list_taxa_show <-   lapply (list_occ_fish, function (i)
    lapply ( ranks, function (k)  { # for each rank # for each dataset
  
    
    taxa_to_show <- unique(i[which(i$taxonRank %in% k),"scientificNameAccepted"])# get the name

    taxa_to_show <- taxa_to_show[order(taxa_to_show)] # order

    taxa_to_show <- knitr::combine_words(taxa_to_show, and = "") # separate with commas
    taxa_to_show
  }))



# benthos to show

ranks_benthos <- unique(unlist(sapply (list_occ_benthos, "[[", "taxonRank")))

# list of taxa
list_taxa_show_benthos <- lapply ( ranks_benthos, function (k)  # for each rank
  
  lapply (list_occ_benthos, function (i) { # for each dataset
   

    
    taxa_to_show <- unique(i[which(i$taxonRank %in% k),"scientificNameAccepted"])# get the name

    taxa_to_show <- taxa_to_show[order(taxa_to_show)] # order

    taxa_to_show <- knitr::combine_words(taxa_to_show, and = "") # separate with commas
    taxa_to_show
  }))




```
Fig. 4: Trends in the number of scientific names accumulated over time for fish (top) and benthos (bottom). The vertical segments depict the year in which data included in each Dataset started to be collected. The horizontal bars depict the formal funding as follows: dark gray bar: Sisbiota, CNPq; light gray bar: PELD, CNPq; green bar: ReefSYN, SinBiose CNPq.

# 2.3 Data sources and sampling protocol

## 2.3.1 Reef fish datasets
### 2.3.1.1 Dataset I: Fish communities from the Brazilian province
This dataset, used by Morais et al. (2017), includes fish counts and size estimates in 4,570 transects distributed over 137 localities in 20 different sites spanning from 0° to 27°S latitude degrees (including oceanic islands). Sampling descriptors include *Observer ID*, *site depth*, and *date*. The geographical information (coordinates) is indicated here at the site level (i.e., represents a set of replicates of transects in a given time and place). The method used to sample fish was underwater visual census (UVC) with 20 × 2m in dimension, and samples were obtained in the austral summer from 2007 to 2011. Strip transects performed by free or scuba diving, during which the diver unwound a tape while identifying, counting and estimating the total length (LT, cm) of non-cryptic fishes >10 cm. And, while retracting the tape, following the same procedure for benthic-associated non-cryptic fishes <10 cm and cryptic species (see Morais et al. 2017 for more details). The dataset also includes data from Krajewski & Floeter (2011).

### 2.3.1.2 Dataset II: Abrolhos Bank monitoring/time series
Fish assemblage data from the Abrolhos Bank was collected by Ronaldo Francini-Filho from 2001 to 2014. The dataset here includes samples of five sites and 28 localities nested within sites but not evenly distributed in space.. The variables in this dataset are related to the description of fish identification and abundance, measured at stationary visual censuses (4 x 2m, 5 min). Depth of sampling varied among sites and ranged between 2 and 15m. Benthic communities assessments were completed at the same sites, localities and depths of fish stationary censuses, using either point-intersect technique (four 10m-transects in each depth and locality) or photo quadrats (10 quadrats, 0.7m2).

### 2.3.1.3 Dataset III: Arraial do Cabo (Rio de Janeiro) monitoring/time series
The data were collected by the [LECAR team](https://www.lecar.uff.br/) from 2003 to 2021, but were annually collected only from 2014 to 2021 at four of the 21 sites monitored. All other sites were sampled opportunistically. Dataset includes fish species, size and abundance recorded at 40m2 (20x2m) belt-transects in rocky reefs in Arraial do Cabo, Rio de Janeiro. Transects were laid at different depths at, approximately, 5m intervals according to local maximum depths, ranging from 1 to 25m deep. Samples include data from two distinct oceanographic domains present locally, one under strong influence of seasonal upwelling, and another with indirect influence of the upwelling.

### 2.3.1.4 Dataset IV: Oceanic islands' monitoring/time series
Dataset of fish recorded in the four oceanic islands of Brazil: Fernando de Noronha Archipelago, Rocas' Atoll, Trindade Island and Martiz Vaz Archipelago, and Saint Peter and Saint Paul's Archipelago. Data were collected from 2013 to 2019, organized by Juan Quimbayo, Thiago Silveira and Cesar Cordeiro (PELD-ILOC team) and is curated by Cesar Cordeiro. The method used to sample fish was the underwater visual census (UVC). These data were generated by the team of  applying the same UVS protocol (20 x 2m strip transect) described above and used by Morais et al. (2017). Transects were laid at different depths at 5m intervals according to local maximum depths, ranging from 3 to 25m deep.

### 2.3.1.5 Dataset V: Santa Catarina monitoring/time series
The data was collected yearly by the [LBMM team](https://lbmm.ufsc.br/), from 2007 to 2021. Dataset includes fish species, size and abundance recorded at 40m2 (20x2m) belt-transects in nine sites along the Santa Catarina state coastal area. Transects were laid at different depths at, approximately, 5m intervals according to local maximum depths, ranging from 1 to 25m deep (Quimbayo et al. 2022).

### 2.3.1.6 Dataset VI: Trophic interactions along the Western Atlantic
This dataset, used by Longo et al. (2019), includes records of feeding behavior of fish over the benthic community, as well interactions among fish. These data were obtained with 1,133 unique videoplots deployed in 70 localities from 17 different sites spanning 61 degrees of latitude, from 34°N to 27°S. Sampling descriptors include *recording time*, *date*, *depth*, and *observed ID*. At each site, static videos were replicated at 2 × 1 m areas positioned haphazardly on the reefs, with 5–10 m between replicates. Feeding pressure was estimated as the product of the number of bites taken and the body mass (in kilograms) of the fish, accounting for body size variation. Individual biomass was obtained through length–weight relationships from the literature (Froese & Pauly, 2016).

### 2.3.1.7 Dataset VII: Alcatrazes monitoring/time series
This dataset has been collected through the collective effort among Instituto Chico Mendes, Centro de Biologia Marinha, Universidade de São Paulo (CEBIMar/USP), LECAR and LBMM teams. The Alcatrazes Archipelago (AA) is located 36 km offshore the Northern Coast of São Paulo State, Brazil (24°06’03” S, 45°41’25” W; Fig. 1). This archipelago is composed of one main island and 13 rocky outcrops of different size, making up 73 ha of land. The Alcatrazes monitoring program started 2013 until present and has  aimed to monitor reef fish assemblages using belt transects (underwater visual surveys of 40 m2 (20 - 2m transects). A total of 113 species were recorded (109 identified at the level of species and four at the level of genus) along 325 plots (belt transects). In each transect, the divers identified, counted, and estimated the total length (TL) of all fish species observed within a belt transect.

### 2.3.1.8 Dataset VIII: Rio Grande do Norte monitoring/time series
Data collected by Guilherme Longo and Natália Roos in Rio Grande do Norte, based on fishes and benthos collected in the same spatial unit. A transect of 20x2m was used to record fishes, they also deployed 10 photo quadrats to register benthic organisms. Data have been collected yearly since 2016, at depths ranging from 1 to 28 m according to local depth. These data were used in a publication by Natalia Roos [Roos et al. 2019](https://www.int-res.com/prepress/m13005.html).


## 2.3.2 Benthic datasets

### 2.3.2.1 Dataset IX: Benthic communities' monitoring in Abrolhos Bank
A mosaic of 15 high-resolution digital images totaling 0.7 m2 constituted each sample. Quadrats were permanently delimited by fixed metal pins and set at random distances along a 20–50 m axis on the tops of reef pinnacles. Relative coral cover was estimated through the identification of organisms below 300 randomly distributed points per quadrat (i.e., 20 points per photograph) using the Coral Point Count with Excel Extensions software (Kohler and Gill, 2006). The counts of benthic organisms were converted to percentages. 

### 2.3.2.2 Dataset X: Extended benthic communities from the Brazilian province
This dataset was compiled by Erika Santana, Anaíde Aued, and Ronaldo Francini-Filho, and consists of data on benthic organisms sampled in photo quadrats deployed in several sites disposed along the coast and oceanic islands. This dataset is complementary to the dataset of Aued et al. (2018). Following the imaging register, image processing was done using the Coral Point Count with Excel extensions software (CPCe v. 4.1) (Kohler and Gill, 2006). Benthic organisms were identified at different taxonomic levels (morphotype, species, order). Morphotypes were adapted from Steneck and Dethier (1994) in which algae are grouped according to morpho-anatomical characteristics. However, morphotype, bare substrate, sediment, lost information (shade, quadrat, tape) and turf were not included in the data because they do not represent taxonomic entities in which DwC standards are based. The dataset originally had environmental descriptors such as *site depth*, *month* and *year*, which were adequate here using DwC standards. This dataset was combined with the dataset of Aued et al. (2018) in the analysis of Santana et al. (2023). For dataset including benthic cover categories not included here, please contact data providers.

### 2.3.2.3 Dataset XI: Benthic communities from the Brazilian province
includes site-level cover information of ~100 benthic taxa from 3,855 photo quadrats deployed in 40 localities from 15 different sites, spanning 0° to 27°S latitude degrees. The sampling sites indicated here are the same from Morais et al. (2017). Benthic organisms were identified at the lowest possible taxonomic level (i.e., morphotype, species, order) according to constraints related to image identification. Image processing was done using the Coral Point Count with Excel extensions software (CPCe v. 4.1) (Kohler and Gill, 2006), with the exception of data from Trindade island which was analysed using the photoQuad software (Trygonis & Sini, 2012). Bare substrate, sediment, lost information (shade, quadrat, tape) and turf were not included in the data because they do not represent taxonomic entities in which DwC standards are based. Sampling descriptors include *photo quadrat ID*, *site depth*, *date* or *year* and, for some samples, *observer ID.* The geographical information is indicated at the site level. Six to twenty 2x1m horizontal surfaces of reef area on each depth strata were haphazardly selected for taking photo quadrats (25 x 25 cm) and characterized the benthic community. Each 2x1m area was set, at least, two meters apart from each other and considered as independent sample units.
 

### 2.3.2.4 Dataset XII: Benthic communities' monitoring/time series from oceanic islands
Dataset of benthic communities recorded in the four oceanic islands of Brazil: Fernando de Noronha Archipelago, Rocas’ Atoll, Trindade Island and Martin Vaz Archipelago, and Saint Peter and Saint Paul’s Archipelago. These data were collected from 2013 to 2022, organized by Thiago Silveira and Cesar Cordeiro (PELD-ILOC team) and curated by Cesar Cordeiro. These data were generated by the team of [PELD ILOC project](http://peldiloc.sites.ufsc.br/), and are still being sampled annually. As the images from 2020 to 2022 are still under analysis, these data were not included here. The method for registering the benthic community included three to six fixed transects (20 m) parallel to the coastline placed at 2 m intervals. Ten to 11 (50 × 50 cm) photo quadrats were taken at each transect in each year and locality from 2013 to 2019. Following the imaging register, image processing was done using the Coral Point Count with Excel extensions software (CPCe v. 4.1) (Kohler and Gill, 2006). This stage consisted on the identification of major taxonomic, morpho-anatomical benthic groups and the estimation of their relative cover in samples. Bare substrate, sediment, lost information (shade, quadrat, tape), morpho-anatomical benthic groups and turf were not included in the data because they do not represent taxonomical entities in which DwC standards are based. Software analysis were performed by overlaying 50 random points on each image and identifying the organisms immediately below each point details (details in Zamoner et al. 2021).



### 2.3.2.4 Dataset XIII: Benthic communities from Rio Grande do Norte
See 2.3.1.4


# 2.4 Data management and standardization

We strive to standardize data and follow the FAIR principles of data science -- i.e. data should be "findable", "accessible", "interoperable", and "reusable" (Wilkinson et al., 2016). Data holders supplied their datasets to the database managers in digital format (e.g., spreadsheets, csv files). The datasets were predominantly managed in the R Programming Environment (R Core Team 2022).


# 2.5 Data structure

All datasets are available as a Darwin Core Archive (DwC-A), and all fields were named compliant with Darwin Core (DwC) standards (TDWG, 2015), which includes an event core (event sampling data), occurrence (taxonomic data), and extended measurement or fact (environmental variables and taxa counts or cover) (Fig. 5).


```{r include=T,echo=F, warning=F, fig.align='center', out.width="75%",out.height="75%"}
# All defaults

knitr::include_graphics(here::here ("DwC_output","dataStructure.png"))

```
Fig. 5: ReefSYN data structure following the Darwin Core Standard. Dataset codes in Tables 1 and 2.


# 2.6 Quality assurance/quality control procedures 

- The name of all taxa were checked against the WoRMS database, using the R package “worrms” (World Register of Marine Species (WoRMS, 2022)). Thus, valid scientific names were called “scientificNameAccepted” following the DwC standard.
- Samples were always collected by researchers or trained students.
- Sampling methods are broadly used and accepted worldwide.
- Data were checked by two data managers (A.L. Luza, C. Cordeiro) and questions were sent to data owners whenever necessary. The data owners are listed in the Author contributions’ section. Overall, main inconsistencies found in the datasets (and solved by contacting the data owners) were related with 1) region names; 2) locality names; 3) site names; 4) different IDs of unique sampling events; 5) format of sampling day, month and year; 6) Missing sampling day, month, year; 7) lack of geographical information; 8) misspelling  of species names; 9) sampling unit identity (e.g., one video plot, photoquadrat).
- Data owners shared Microsoft Excel spreadsheets (“.csv”, “.xlsx”), often containing data in a wide format. Most data were transformed into a long format, organized, standardized (following the DwC standard) and processed using the R Programming Environment (R Core Team, 2022). Some modifications that could not be easily done in R, regarding the splitting of sample IDs, were done in Microsoft Excel. It consisted in dealing with eventIDs separated by different separators (“ _ “, ” . ” , …) and we used Excel to have more control on what information to get.
R routines (scripts) are available at GitHub, together with the raw data.
- Softwares used to identify benthos were cited in the description of each dataset so the data user is aware of them.



# 2.7 Taxonomic coverage

General taxonomic coverage description

The seven fish datasets comprise the description of the occurrence of `r Nspp` taxa from `r Ngenera` genera, `r Nfamfish` families and `r Nclafish` classes, being them `r paste (fish_class[1],fish_class[2], sep="and") `. The five benthic datasets comprise the description of the occurrence of `r Ntaxa`  taxa, `r Ngenera` genera, `r Nfam` families, `r Ncla`, and `r Nkin` kingdoms, being them `r king_to_show`. Because the photographic identification does not always allow the species level identification, the number of genera and families are  comparatively high relative to species richness.  In general, the datasets with a large spatial coverage (datasets I and X from SISBIOTA-Mar project) showed higher taxa richness in comparison with local monitoring (datasets IV and XI) (Fig. 6).



```{r, echo = F, fig.height=6, fig.width=10, message=F, warning=F, fig.align= "center", out.width="100%", out.height="100%", dpi=600}

# All defaults


# plot

dat_barplot_fish <- lapply (list_occ_fish, function (i)
  
  i %>% select (Dataset,
                scientificNameAccepted,
                genus,
                family,
                order,
                class,
                phylum,
                kingdom
                ) %>%
    
    distinct()
    
  )

# melt
dat_barplot_fish <- do.call(rbind,dat_barplot_fish)


# Get full taxonomical classification
barplot_fish <- dat_barplot_fish %>% 
   group_by(Dataset) %>% 
  summarise(Species = n_distinct(scientificNameAccepted),
            Phylum = n_distinct(phylum),
            Class = n_distinct(class),
            Order = n_distinct(order),
            Family = n_distinct(family),
            Genus = n_distinct(genus)) %>%
  pivot_longer(cols = Species:Genus, names_to = "taxa_rank", values_to = "richness") %>% 
  mutate(taxa_rank = factor(taxa_rank, levels = c("Phylum", "Class", "Order", "Family", "Genus", "Species")))  %>% 
  ggplot(aes(y = richness, x = Dataset, fill = taxa_rank)) +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(legend.position = "",
        axis.title.y = element_text(size = 14),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12)) +
  labs(y = "Taxa richness (n)", x = "", title = "(a) Fish taxa") +
  scale_fill_brewer(palette="Spectral")
  


# benthos

dat_barplot_benthos <- lapply (list_occ_benthos, function (i)
  
  i %>% select (Dataset,
                scientificNameAccepted,
                genus,
                family,
                order,
                class,
                phylum,
                kingdom
                ) %>%
    
    distinct()
    
  )

# melt
dat_barplot_benthos <- do.call(rbind,dat_barplot_benthos)


# Get full taxonomical classification
barplot_benthos <- dat_barplot_benthos %>% 
   group_by(Dataset) %>% 
  summarise(Species = n_distinct(scientificNameAccepted),
            Phylum = n_distinct(phylum),
            Class = n_distinct(class),
            Order = n_distinct(order),
            Family = n_distinct(family),
            Genus = n_distinct(genus)) %>%
  pivot_longer(cols = Species:Genus, names_to = "taxa_rank", values_to = "richness") %>% 
  mutate(taxa_rank = factor(taxa_rank, levels = c("Phylum", "Class", "Order", "Family", "Genus", "Species")))  %>% 
  ggplot(aes(y = richness, x = Dataset, fill = taxa_rank)) +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(legend.position = "",
        axis.title.y = element_text(size = 14),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12)) +
  labs(y = "", x = "", title = "(a) Benthic taxa") +
  scale_fill_brewer(palette="Spectral")
  
# get the legend
legend_to_plot <- get_legend (barplot_benthos + theme(legend.position="right",
                        legend.title = element_blank()))

# arrange panel
(barplot_fish | barplot_benthos) + legend_to_plot + plot_layout(ncol = 3, widths=c(2,2,1))






```
Fig. 6: Taxa richness according to taxonomic classification in each dataset. Column labels denote different reef fish and benthos datasets (see Fig. 5).

# 2.8 Taxonomic coverage per dataset

## 2.8.1 Fish

*Taxonomic ranks*

Kingdom: `r unique(unlist(lapply (list_occ_fish, function (i) i$kingdom)))[order(unique(unlist(lapply (list_occ_fish, function (i) i$kingdom))))]`

Phylum: `r unique(unlist(lapply (list_occ_fish, function (i) i$phylum)))[order(unique(unlist(lapply (list_occ_fish, function (i) i$phylum))))]`

Class: `r knitr::combine_words(unique(unlist(lapply (list_occ_fish, function (i) i$class)))[order(unique(unlist(lapply (list_occ_fish, function (i) i$class))))], and = "")`

Orders: `r knitr::combine_words(unique(unlist(lapply (list_occ_fish, function (i) i$order)))[order(unique(unlist(lapply (list_occ_fish, function (i) i$order))))], and = "")`

Families: `r knitr::combine_words(unique(unlist(lapply (list_occ_fish, function (i) i$family)))[order(unique(unlist(lapply (list_occ_fish, function (i) i$family))))], and = "")`

Genus: `r knitr::combine_words(unique(unlist(lapply (list_occ_fish, function (i) i$genus)))[order(unique(unlist(lapply (list_occ_fish, function (i) i$genus))))], and = "")`

Species: `r knitr::combine_words(unique(unlist(fish_taxa))[order(unique(unlist(fish_taxa)))], and = "")`


## 2.8.2 Benthos

*Taxonomic ranks*

Kingdom: `r unique(unlist(lapply (list_occ_benthos, function (i) i$kingdom)))[order(unique(unlist(lapply (list_occ_benthos, function (i) i$kingdom))))]`

Phylum: `r unique(unlist(lapply (list_occ_benthos, function (i) i$phylum)))[order(unique(unlist(lapply (list_occ_benthos, function (i) i$phylum))))]`

Class: `r knitr::combine_words(unique(unlist(lapply (list_occ_benthos, function (i) i$class)))[order(unique(unlist(lapply (list_occ_benthos, function (i) i$class))))], and = "")`

Orders: `r knitr::combine_words(unique(unlist(lapply (list_occ_benthos, function (i) i$order)))[order(unique(unlist(lapply (list_occ_benthos, function (i) i$order))))], and = "")`

Families: `r knitr::combine_words(unique(unlist(lapply (list_occ_benthos, function (i) i$family)))[order(unique(unlist(lapply (list_occ_benthos, function (i) i$family))))], and = "")`

Genus: `r knitr::combine_words(unique(unlist(lapply (list_occ_benthos, function (i) i$genus)))[order(unique(unlist(lapply (list_occ_benthos, function (i) i$genus))))], and = "")`

Species: `r knitr::combine_words(unique(unlist(benthic_taxa))[order(unique(unlist(benthic_taxa)))], and = "")`


# 3 Data availability
These data are published under CC BY-NC licence. 
"Policy of data sharing and use" can be found in the ReefSYN Organization in Github (available [here::here](https://github.com/Sinbiose-Reefs/reefsyn_site/blob/master/DataPolicy_SINBIOSE.pdf)). Data embargo goes up to **January 2024**, one year after the end of ReefSYN funding.


# 4 Potential use and conclusions
Develop this. Mention the objectives of published and ongoing papers.


# Author contributions
AL Luza and CAMM Cordeiro standardized the data to the DwC Standard. Data holders: CAMM Cordeiro, AW Aued, CEL Ferreira, T Mendes, N Roos, GO Longo, RB Francini-Filho, SR Floeter.

# Competing interests
The authors have no competing interest to declare.

# Disclaimer
Embargo for fish dataset III (Time series of Arraial do Cabo, Rio de Janeiro)

# Permits
Data were collected following Brazilian government legislation. This includes authorization to the SISBIOTA-Mar project to assess images of the benthic communities along the Brazilian reefs, under the permits # 06/2012 (Parcel do Manuel Luis; SEMA-MA), # 29953–1 (Rocas Atoll; ICMBio/ MMA—Brazilian Ministry of Environment), # 29687–2 (Fernando de Noronha; ICMBio/ MMA—Brazilian Ministry of Environment), # 32145–1 (Costa dos Corais, ICMBio/ MMA—Brazilian Ministry of Environment), # 22637 (Abrolhos, ICMBio/ MMA—Brazilian Ministry of Environment), # 4416–1 (Trindade Island, ICMBio/ MMA—Brazilian Ministry of Environment), # 37869 (Alcatrazes, ICMBio/ MMA—Brazilian Ministry of Environment), # 21422 (Florianópolis Norte, ICMBio/ MMA—Brazilian Ministry of Environment), and for RN Maracajaú (APA dos Recifes de Corais, IDEMA-RN). 


# Acknowledgements
Students and researchers that collected the data. ReefSYN was supported by the Center for Synthesis in Biodiversity and Ecosystem Services  [SinBiose] (CNPq). 
Thiago Silveira (PELD-ILOC team)

# Financial support

This project is funded by the Center for Synthesis in Biodiversity and Ecosystem Services  [SinBiose](http://www.sinbiose.cnpq.br/web/sinbiose) (CNPq #442417/2019-5, granted to MGB). The center is part of the National Council for Scientific and Technological Development (*Conselho Nacional de Desenvolvimento Científico e Tecnológico*, CNPq).Researchers from the "Brazilian Marine Biodiversity Research Network – SISBIOTA-Mar" (CNPq #563276/2010-0 and FAPESC #6308/2011-8 to SRF) and ‘‘Programa de Monitoramento de Longa Duração das Comunidades Recifais de Ilhas Oceânicas – PELD ILOC’’ (CNPq 441241/2016-6, to CELF), initiatives that collected and shared their data sets used in this research. ALL received post-doctoral fellowships from CNPq (#153024/2022-4, #164240/2021-7, #151228/2021-3, #152410/2020-1). GOL is grateful to a research productivity scholarship provided by the Brazilian National Council for Scientific and Technological Development (CNPq; 310517/2019-2) and Serrapilheira Institute (Grant No. Serra-1708-15364) for continued research support. 

# References

Aued AW, Smith F, Quimbayo JP, Cândido DV, Longo GO, Ferreira CEL, ... Segal B (2018). Large-scale patterns of benthic marine communities in the Brazilian Province. PLoS ONE, 13(6), e0198452. https://doi.org/10.1371/journal.pone.0198452

Briggs JC (1974) Marine zoogeography. McGraw-Hill, New York.

Bruce T, Meirelles PM, Garcia G, Paranhos R, Rezende CE, et al. (2012) Abrolhos Bank Reef health evaluated by means of water quality, microbial diversity, benthic cover, and fish biomass data. PLoS ONE 7(6): e36687. doi:10.1371/journal.pone.0036687

Cord I, Nunes LT, Barroso CX, Freire AS, Gadig OBF, Gomes PB, ... Floeter SR (2022) Brazilian marine biogeography: a multi-taxa approach for outlining sectorization. Marine Biology, 169: 61. https://doi.org/10.1007/s00227-022-04045-8

Darwin Core Task Group (2009) Darwin Core. Biodiversity Information Standards (TDWG) http://www.tdwg.org/standards/450

Floeter SR, Rocha LA, Robertson DR, Joyeux JC, Smith-Vaniz WF, Wirtz P, ... Bernardi G (2008) Atlantic reef fish biogeography and evolution. Journal of Biogeography, 35: 22–47. https://doi.org/10.1111/j.1365-2699.2007.01790.x

Inagaki KY, Pennino MG, Floeter SR, Hay ME, Longo GO (2020) Trophic interactions will expand geographically but be less intense as oceans warm. Global Change Biology, 26: 6805–6812. https://doi.org/10.1111/gcb.15346

Krajewski JP, Floeter SR (2011) Reef fish community structure of the Fernando de Noronha Archipelago (Equatorial Western Atlantic): the influence of exposure and benthic composition. Environ Biol Fish 92, 25. doi:10.1007/s10641-011-9813-3

Loiola M, Cruz ICS, Lisboa DS, Mariano-Neto E, Leão ZMAN, Oliveira MDM, Kikuchi RKP (2019) Structure of marginal coral reef assemblages under different turbidity regime. Marine Environmental Research, 147: 138–148. https://doi.org/10.1016/j.marenvres.2019.03.013

Longo GO, Hay ME, Ferreira CEL, Floeter SR (2019) Trophic interactions across 61 degrees of latitude in the Western Atlantic. Glob. Ecol. Biogeogr. 28: 107-117. doi:10.1111/geb.12806

Michener WK, Jones MB (2012) Ecoinformatics: supporting ecology as a data-intensive science. Trends Ecol Evol. 27(2):85-93. doi:10.1016/j.tree.2011.11.016.

Mies M, Francini-Filho RB, Zilberberg C, Garrido AG, Longo GO, Laurentino E, ... Banha TNS (2020) South Atlantic Coral Reefs Are Major Global Warming Refugia and Less Susceptible to Bleaching. Frontiers in Marine Science, 7: 514. https://doi.org/10.3389/fmars.2020.00514

Morais RA, Ferreira CEL, Floeter SR (2017) Spatial patterns of fish standing biomass across Brazilian reefs, Southwestern Atlantic. Journal of Fish Biology, 91(6): 1642–1667.

Pinheiro HT, Rocha LA, Macieira RM, Carvalho-Filho A, Anderson AB, Bender MG, ... Floeter SR (2018) Southwestern Atlantic reef fishes: zoogeographic patterns and ecological drivers reveal a secondary biodiversity center in the Atlantic Ocean. Diversity and Distributions, 24, 951–965. doi:10.1111/ddi.12729

Quimbayo JP, Nunes LT, Silva FC, AB Anderson, Barneche DR, Cartele AM, Cord I, Dalben A, Ferrari DS, Fontoura L, Fiuza TM, Longo GO, Morais RA, Siqueira AC, Floeter SR (2022) TimeFISH: Fish assemblages in a 15-year monitoring program (Summary). Zenodo. doi:10.5281/zenodo.7402221

Reichman OJ, Jones MB, Schildhauer MP (2011) Challenges and opportunities of open data in ecology. Science, 331(6018):703-5. doi:10.1126/science.1197962. PMID: 21311007.
Steneck RS, Dethier MN (1994) A Functional Group Approach to the Structure of Algal-Dominated Communities. Oikos. 69(3): 476-498. doi:10.2307/3545860

Santana, E.F.C., Mies, M., Longo, G.O., Menezes, R., Aued, A.W., Luza, A.L., … Francini-Filho, R.B. (2023). Turbidity shapes shallow Southwestern Atlantic benthic reef communities. Marine Environmental Research, 183, 105807. https://doi.org/10.1016/j.marenvres.2022.105807

UNESCO (2021) UNESCO Recommendation on Open Science. Available at: https://unesdoc.unesco.org/ark:/48223/pf0000379949. 34 pages

Zamoner JB, Aued AW, Macedo-Soares LCP, Picolotto VAP, Garcia CAE, Segal B (2021) Integrating Oceanographic Data and Benthic Community Structure Temporal Series to Assess the Dynamics of a Marginal Reef. Front. Mar. Sci. 8: 762453 doi:10.3389/fmars.2021.762453

