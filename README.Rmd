---
title:  "Standardized datasets of Brazilian reef diversity in space and time"
author: "Reef Synthesis Working Group"
date: "2023/08/0"
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

<!-- badges: start -->
<!-- badges: end -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Target journal: Earth System Science Data


Here we present the raw figures of the datapaper. We adopted the Darwin Core Standard to organize the 16 datasets. The root R script "RUN_TO_ORGANIZE_DATA_INTO_DwC.R" can be used to generate these organized datasets from raw datasets. By running this script you will create the folder 'DwC_output' which will host the processed datasets (most of them in a particular folder; exceptions are datasets II and XII (fish and benthos from the ABrolhos Bank), and XI and XVI (fish and benthos from Rio Grande do Norte state), which were produced by the same researchers).

Folders in this project:

- **Data**: raw datasets. Each dataset folder has its own R script to organize data (DwC standard);

- **DwC_output**: the processed data, after running each organization script;

- **Policy**: policies of authorship and data sharing (only Portuguese);

- **R**: folder with R scripts. Scratch of a Shiny App;


## Figure: Team members' Institutes and Research Topics
```{r dev = c("png", "tiff", "pdf"), echo = F, fig.height=6.5,fig.width=6.5,fig.margin=F,fig.align="center", message=F,warning=F,out.width="80%",out.height="80%",dpi=600}


## R code to load data sets and plot points
## call packages

source("R/packages.R")
source("R/functions.R")

# open researcher data
researcher_data <- read.xlsx(here::here("Data","researcher_data","PLANILHA_CONSOLIDADA.xlsx"), sheet = 1, colNames = TRUE, detectDates=F)

# formatting data
researcher_data$objetivos <- as.character (researcher_data$objetivos)
researcher_data$titulo_portugues <- as.character (researcher_data$titulo_portugues)
researcher_data$titulo_ingles <- as.character (researcher_data$titulo_ingles)

## extrair as colunas que desejo analaisar
institution <- strsplit(researcher_data$instituicao,",")
institution <- unlist(strsplit(unlist(institution), "/"))
institution <- gsub (" ","",institution)

# df for word-cloud
institution <- data.frame (inst=unique(institution) [order (unique(institution))],
                           freq=table(institution) [order (names(table(institution)))])

# map institutions
# mapa mundi
world <- ne_countries(scale = "medium", returnclass = "sf")
world$colour_Country <- ifelse (world$name_sort %in% researcher_data$country, "orange","gray90")

# cortar o mapa para ver a america do Sul e parte da central
wm <- ggplot() + 
  geom_sf (data=world, size = 0.1, 
           fill= world$colour_Country,
           colour="gray40") +
  #coord_sf (xlim = c(-50, -25),  ylim = c(-30, 4), expand = FALSE) +
  theme_bw() + #xlab ("Longitude")  + ylab ("Latitude") +
  theme(panel.border = element_blank(), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "#f4f9f9",#darkslategray1
                                        colour = "#f4f9f9"),
        axis.text.x = element_text(size=8),
        axis.ticks.x=element_line(size=1),
        axis.text.y = element_text(size=8),
        axis.ticks.y=element_line(size=1),
        axis.title.x = element_text(size=10),
        axis.title.y = element_text(size=10),
        #title = element_blank(),
        plot.margin = unit(c(0,-0.8,0,0.3), "cm")) +
  labs (title = "A) Institutions of ReefSYN team members")

# map
map_SC <- wm + geom_point(data  = researcher_data %>%
                                    select (instituicao, lat,long) %>%
                                    group_by(instituicao) %>%
                            summarise (lat = mean(lat,na.rm=T),
                                       long=mean(long,na.rm=T)),aes (x=long,y=lat), 
                size=3) + 
  geom_label_repel(data = researcher_data%>%
                                    select (instituicao, lat,long) %>%
                                    group_by(instituicao) %>%
                            summarise (lat = mean(lat,na.rm=T),
                                       long=mean(long,na.rm=T)), aes(x=long, 
                                  y=lat,
                                  label = instituicao),
                  size = 3,
                  fill = "white",
                  alpha=0.8,
                  min.segment.length = 0,
                  box.padding = 0.3,
                  max.overlaps=100)+
  xlab("") + ylab("") + 
  theme(legend.position = "none") 


### english title
titulo_ingles <- as.character (researcher_data$titulo_ingles [which(researcher_data$titulo_ingles != "Indefinido")])
##  df for wcloud
freq_texto_wc <-  function_freq_texto_wc (titulo_ingles)

par(mar = c(4, 4, .1, .1))

## institutions

#wordcloud::wordcloud(words = institution$inst, freq = institution$freq.Freq,
#          min.freq = 1,scale=c(4, .2),
#          max.words=50, 
#          random.order=FALSE, rot.per=0.15, 
#          colors = RColorBrewer::brewer.pal(8, "Dark2"))
#

#dir.create("output")
#pdf (here ("output"),file= "fig1A.pdf")
map_SC
#dev.off()


# wordcloud
wordcloud::wordcloud(words = freq_texto_wc$word, 
          freq = freq_texto_wc$freq.Freq,
          min.freq = 2,scale=c(4, .2),
          max.words=max(freq_texto_wc$freq.Freq)+3, 
          random.order=FALSE, rot.per=0.15, 
          colors = RColorBrewer::brewer.pal(8, "Dark2"),
          main = "Title")



```
Institutes and research topics explored by ReefSYN team members and collaborators. Abbreviations: AIMS: Australian Institute Of Marine Science; CDU: Charles Darwin University; CEBIMar: Centro de Biologia Marinha of the University of São Paulo; ICMBio: Chico Mendes Institute for Biodiversity Conservation; IO-USP: Oceanographic Institute of the University of São Paulo; PSL: Paris Sciences et Lettres University; UENF: Universidade Federal do Norte Fluminense; UFES: Universidade Federal do Espírito Santo; UFF: Universidade Federal Fluminense; UFOP: Universidade Federal do Oeste do Pará; UFRN: Universidade Federal do Rio Grande do Norte; UFSC: Universidade Federal de Santa Catarina; UFSM: Universidade Federal de Santa Maria; UnB: Universidade de Brasília.


## ReefSYN Data Structure
```{r include=T,echo=F, warning=F, fig.align='center', out.width="75%",out.height="75%"}
# All defaults

knitr::include_graphics("dataStructure.png")

```
Structure of the datasets gathered by the ReefSYN working group, showing the Darwin Core Standard terms included in most datasets. These terms are part of a standardized glossary maintained by the Darwin Core Task Group (2009).


# Data availability
These data are published under CC BY-NC license. “Policy of data sharing and use” can be found in the ReefSYN Organization in Github (available at  [here::here](https://github.com/Sinbiose-Reefs/reefsyn_site/blob/master/DataPolicy_SINBIOSE.pdf)). Data embargo goes up to January 2024, one year after the end of ReefSYN funding by the SinBiose.

# Acknowledgements
Students and researchers that collected the data. ReefSYN was supported by the Center for Synthesis in Biodiversity and Ecosystem Services (SinBiose, CNPq). Thiago Silveira and Marina Sissini (PELD-ILOC team).

# Financial support

This project is funded by the Center for Synthesis in Biodiversity and Ecosystem Services SinBiose (https://www.gov.br/cnpq/pt-br/acesso-a-informacao/acoes-e-programas/programas/sinbiose-1) (CNPq #442417/2019-5, granted to MGB). The center is part of the National Council for Scientific and Technological Development (Conselho Nacional de Desenvolvimento Científico e Tecnológico, CNPq). Researchers from the “Brazilian Marine Biodiversity Research Network – SISBIOTA-Mar” (CNPq #563276/2010-0 and FAPESC #6308/2011-8 to SRF) and ‘‘Programa de Monitoramento de Longa Duração das Comunidades Recifais de Ilhas Oceânicas – PELD ILOC’’ (CNPq 441241/2016-6, to CELF), initiatives that collected and shared their data sets used in this research. ALL received post-doctoral fellowships from CNPq (#153024/2022-4, #164240/2021-7, #151228/2021-3, #152410/2020-1). J.P.Q. received post-doctoral fellowship from FAPESP (2018/21380-0 and 2021/). TCM received post-doctoral fellowships from FAPERJ (E-26/202.372/2021) and CNPq (#102450/2022-6). GOL is grateful to a research productivity scholarship provided by the Brazilian National Council for Scientific and Technological Development (CNPq; 310517/2019-2) and Serrapilheira Institute (Grant No. Serra-1708-15364) for continued research support.


## This paper was produced using the following software and associated packages:

```{r pressure, echo=F,warning=F,message=F}

source("R/packages.R")
sessionInfo()


```


